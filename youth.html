<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mládež - Šachový oddíl TJ Bižuterie Jablonec</title>
    <meta name="description"
        content="Mládežnický šach v Jablonci nad Nisou. Tréninky, turnaje a úspěchy našich mladých šachistů.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/game-viewer2.css">
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
        integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU" crossorigin="anonymous">
    <style>
        /* Custom styles for the lightbox gallery provided in the request, adapted for the site */
        .sj-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .sj-gallery a {
            display: block;
            position: relative;
            aspect-ratio: 1/1;
            overflow: hidden;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
        }

        .sj-gallery a:hover {
            transform: scale(1.05);
        }

        .sj-gallery img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Lightbox */
        .sj-lightbox {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 2rem;
            z-index: 9999;
        }

        .sj-lightbox:target {
            display: flex;
        }

        .sj-lightbox img {
            max-width: 90vw;
            max-height: 85vh;
            border-radius: var(--border-radius);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
        }

        .sj-backdrop {
            position: absolute;
            inset: 0;
            cursor: default;
        }

        .sj-close,
        .sj-prev,
        .sj-next {
            position: absolute;
            text-decoration: none;
            color: white;
            font-size: 2rem;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transition: background 0.3s;
        }

        .sj-close:hover,
        .sj-prev:hover,
        .sj-next:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .sj-close {
            top: 20px;
            right: 20px;
        }

        .sj-prev {
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .sj-next {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>

<body>
    <header id="global-header"></header>

    <main>
        <section class="container" style="margin-top: 40px;">
            <h1 class="section-title">Mládež</h1>

            <!-- Training Info -->
            <div class="card"
                style="margin-bottom: 3rem; background: linear-gradient(135deg, var(--card-bg), rgba(59, 130, 246, 0.1)); border-left: 4px solid var(--primary-color);">
                <div class="card-content">
                    <h2 style="color: var(--primary-color); margin-bottom: 1rem;"><i
                            class="fa-solid fa-graduation-cap"></i> Tréninky mládeže</h2>
                    <p style="font-size: 1.1rem; line-height: 1.6;">
                        Chcete, aby si děti vyzkoušely šachy? Přijďte do městské haly do zasedací místnosti
                        <strong>každý čtvrtek od 16:00</strong>.
                    </p>
                </div>
            </div>

            <!-- Competition Standings - Dynamic from API -->
            <h2 style="margin-bottom: 1.5rem; color: var(--primary-color);"><i class="fa-solid fa-trophy"></i> Soutěže
                mládeže</h2>
            <div id="standingsContainer" class="card-grid" style="margin-bottom: 3rem;">
                <!-- Loaded dynamically from API -->
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                    <div
                        style="display: inline-block; width: 40px; height: 40px; border: 4px solid rgba(212, 175, 55, 0.2); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s linear infinite;">
                    </div>
                    <p style="margin-top: 1rem; color: var(--text-muted);">Načítání tabulek...</p>
                </div>
            </div>


            <!-- Game Viewer Section - Created by GameViewer2.create() -->
            <div id="game-viewer-section"
                style="display: none; margin-bottom: 3rem; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden;">
                <!-- GameViewer2.create() will inject the entire structure here -->
            </div>

            <!-- Dynamic News from API - Full Content Display -->
            <h2 style="margin-bottom: 1.5rem; color: var(--primary-color);"><i class="fa-solid fa-newspaper"></i>
                Aktuality z mládeže</h2>
            <div id="youthNewsGrid" class="card-grid" data-news-category="Mládež" data-news-display="full-short"
                data-news-limit="3" data-news-show-stats style="margin-bottom: 3rem; grid-template-columns: 1fr;"></div>

        </section>
    </main>



    <footer id="global-footer"></footer>

    <script src="js/config.js?v=2" defer></script>
    <script src="js/layout-loader.js?v=2" defer></script>

    <script src="js/main.js?v=2" defer></script>
    <script src="js/news-loader.js?v=2" defer></script>
    <script src="js/match-cards.js?v=2" defer></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script src="js/game-viewer2.js?v=3" defer></script>
    <script>
        // Game Viewer Loader - Using GameViewer2.create()
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Fetch games for category "Mládež"
                const res = await fetch(`${API_URL}/viewer-games?category=Mládež`);
                if (res.ok) {
                    const games = await res.json();
                    if (games && games.length > 0) {
                        // Use self-contained plugin - creates everything!
                        GameViewer2.create('#game-viewer-section', games, {
                            title: 'Partie mládeže',
                            maxHeight: 600
                        });
                    }
                }
            } catch (e) {
                console.error("Failed to load games:", e);
            }
        });

        // Load standings from API
        async function loadStandings() {
            const container = document.getElementById('standingsContainer');
            if (!container) return;

            try {
                const res = await fetch(`${API_URL}/standings`);
                const data = await res.json();

                const allStandings = data.standings || data;
                // Filter only Youth
                const youthStandings = Array.isArray(allStandings) ? allStandings.filter(c => c.category === 'youth') : [];

                if (youthStandings.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 4rem 2rem; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px dashed rgba(255,255,255,0.1);">
                            <div style="font-size: 4rem; color: var(--text-muted); opacity: 0.5; margin-bottom: 1rem;">
                                <i class="fa-solid fa-ghost fa-bounce" style="--fa-animation-duration: 3s;"></i>
                            </div>
                            <h3 style="color: var(--text-muted); margin-bottom: 0.5rem;">Tady zatím nic není...</h3>
                            <p style="color: var(--text-muted); font-size: 0.9rem;">Naši šotci data nenašli. Zkuste to později!</p>
                        </div>
                    `;
                    return;
                }

                // Custom Sort: 1. Liga > Krajská soutěž > Krajský přebor > Ostatní
                youthStandings.sort((a, b) => {
                    const getPriority = (name) => {
                        const n = name.toLowerCase();
                        if (n.includes('1. liga')) return 1;
                        if (n.includes('krajská soutěž')) return 2;
                        if (n.includes('krajský přebor')) return 3;
                        return 4;
                    };
                    return getPriority(a.name || '') - getPriority(b.name || '');
                });

                // Prepare a list of cards to initialize after rendering
                const cardsToInit = [];
                container.innerHTML = ''; // Clear container

                const htmlContent = youthStandings.map(comp => {
                    const compName = comp.name || 'Tabulka';

                    // Specific check for completely empty/failed youth competition
                    if (!comp.standings || comp.standings.length === 0) {
                        return `
                            <div style="background: linear-gradient(135deg, rgba(30,30,40,0.9) 0%, rgba(20,20,30,0.95) 100%); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                                <div style="background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, rgba(212,175,55,0.05) 100%); padding: 0.75rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <h4 style="margin: 0; color: var(--primary-color); font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem;">
                                        <i class="fa-solid fa-trophy"></i> ${compName}
                                    </h4>
                                </div>
                                <div style="text-align: center; padding: 3rem 1rem;">
                                    <div style="font-size: 3rem; color: var(--text-muted); opacity: 0.4; margin-bottom: 1rem;">
                                        <i class="fa-solid fa-spider"></i>
                                    </div>
                                    <h3 style="color: var(--text-light); font-size: 1.1rem; margin-bottom: 0.5rem;">Tady je zatím pavučina</h3>
                                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">Žádná data nebyla nalezena. Tabulka ještě neexistuje, nebo systém nenašel data.</p>
                                    ${comp.error ? `<div style="font-size: 0.75rem; color: #fca5a5; margin-bottom: 0.5rem;">Chyba: ${comp.error}</div>` : ''}
                                    ${data.lastUpdated ? `<div style="font-size: 0.75rem; color: var(--text-muted); border-top: 1px solid rgba(255,255,255,0.05); padding-top: 0.5rem; display: inline-block;">Poslední pokus o budíček: ${new Date(data.lastUpdated).toLocaleDateString('cs-CZ')}</div>` : ''}
                                </div>
                            </div>
                        `;
                    }

                    // Pre-calculation for Match Card
                    const ourTeams = comp.standings.filter(s => /bižuterie|jablonec/i.test(s.team));
                    const activeTeams = ourTeams.filter(t => t.schedule && t.schedule.length > 0);
                    let cardId = null;
                    let matchCardHtml = '';
                    let switcherPlaceholderHtml = '';

                    if (activeTeams.length > 0) {
                        cardId = `match-card-${comp.competitionId || Math.random().toString(36).substr(2, 9)}`;

                        // Push to init list
                        cardsToInit.push({
                            id: cardId,
                            data: activeTeams.map(ourTeam => ({
                                schedule: ourTeam.schedule,
                                teamName: ourTeam.team,
                                teamUrl: ourTeam.url || comp.url,
                                compName: comp.name
                            }))
                        });

                        // Set min-height to ensure alignment with other cards
                        // Using 180px which covers card + padding
                        matchCardHtml = `
                            <div style="padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); min-height: 170px; display: flex; flex-direction: column; justify-content: center;">
                                <div id="${cardId}"><i class="fa-solid fa-spinner fa-spin"></i> Načítám kartu...</div>
                            </div>
                        `;

                        switcherPlaceholderHtml = `<div id="switcher-placeholder-${cardId}" style="margin-left: auto;"></div>`;
                    }

                    // Building standard table
                    let html = `
                        <div style="width: 100%; background: linear-gradient(135deg, rgba(30,30,40,0.9) 0%, rgba(20,20,30,0.95) 100%); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                            <div style="background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, rgba(212,175,55,0.05) 100%); padding: 0.75rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: space-between;">
                                <h4 style="margin: 0; color: var(--primary-color); font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fa-solid fa-trophy"></i> ${compName}
                                </h4>
                                ${switcherPlaceholderHtml}
                            </div>
                            
                            <!-- Match Card Injection -->
                            ${matchCardHtml}

                            <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 0.75rem;">
                                <thead>
                                    <tr style="background: rgba(0,0,0,0.3);">
                                        <th style="width: 1px; text-align: center; padding: 0.4rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;">#</th>
                                        <th style="text-align: left; padding: 0.4rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: normal; word-break: break-word;">Družstvo</th>
                                        <th style="width: 1px; text-align: center; padding: 0.4rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;" title="Výhry-Remízy-Prohry">V/R/P</th>
                                        <th style="width: 1px; text-align: right; padding: 0.4rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;" title="Zápasové body">Body</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;

                    if (comp.standings && comp.standings.length > 0) {
                        comp.standings.forEach((s, idx) => {
                            const isBizuterie = s.isBizuterie || s.team.toLowerCase().includes('bižuterie') || s.team.toLowerCase().includes('jablonec');
                            const bgColor = idx % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'rgba(0,0,0,0.15)';

                            let positionBadge = '';
                            if (s.rank === 1) positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #ffd700, #b8860b); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #000;">1</span>';
                            else if (s.rank === 2) positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #c0c0c0, #808080); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #000;">2</span>';
                            else if (s.rank === 3) positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #cd7f32, #8b4513); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #fff;">3</span>';
                            else positionBadge = `<span style="color: var(--text-muted); font-size: 0.7rem;">${s.rank}</span>`;

                            // Interactive Row Logic
                            let rowClickHandler = '';
                            let cursorStyle = '';

                            if (isBizuterie && cardId) {
                                // Find index in activeTeams (which corresponds to match card tabs)
                                const teamIndex = activeTeams.findIndex(t => t.team === s.team);
                                if (teamIndex !== -1) {
                                    rowClickHandler = `onclick="switchTeam('${cardId}', ${teamIndex})"`;
                                    cursorStyle = 'cursor: pointer;';
                                }
                            }

                            const rowStyle = isBizuterie
                                ? `background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, ${bgColor} 100%); border-left: 3px solid var(--primary-color); ${cursorStyle}`
                                : `background: ${bgColor};`;
                            const teamStyle = isBizuterie ? 'font-weight: 600; color: var(--primary-color);' : '';
                            const wdl = (s.wins !== undefined) ? `<span style="color:#4ade80">${s.wins}</span>/<span style="color:#fbbf24">${s.draws || 0}</span>/<span style="color:#f87171">${s.losses || 0}</span>` : '-';

                            html += `
                                <tr ${rowClickHandler} style="${rowStyle} transition: background 0.2s;" onmouseover="this.style.background='rgba(212,175,55,0.1)'" onmouseout="this.style.background='${isBizuterie ? 'linear-gradient(90deg, rgba(212,175,55,0.15) 0%, ' + bgColor + ' 100%)' : bgColor}'">
                                    <td style="padding: 0.35rem 0.4rem; text-align: center;">${positionBadge}</td>
                                    <td style="padding: 0.35rem 0.4rem; ${teamStyle} font-size: 0.78rem;">${s.team}</td>
                                    <td style="padding: 0.35rem 0.4rem; text-align: center; font-family: monospace; font-size: 0.72rem; white-space: nowrap;">${wdl}</td>
                                    <td style="padding: 0.35rem 0.4rem; text-align: right; font-weight: 700; font-family: monospace; font-size: 0.85rem;">${s.points !== null ? s.points : '-'}</td>
                                </tr>
                            `;
                        });
                    }

                    const sourceName = (comp.url && comp.url.includes('chess-results')) ? 'Chess-Results.com' : 'ŠSČR';
                    const sourceUrl = comp.url || comp.chessczUrl || '#';

                    html += `
                                </tbody>
                            </table>
                            </div>
                            <div style="padding: 0.75rem 1rem; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 0.7rem; color: var(--text-muted);">
                                    ${data.lastUpdated ? `Aktualizováno: ${new Date(data.lastUpdated).toLocaleDateString('cs-CZ')}` : ''}
                                </div>
                                <a href="${sourceUrl}" target="_blank" style="color: var(--text-muted); text-decoration: none; font-size: 0.75rem; display: flex; align-items: center; gap: 0.3rem; transition: color 0.2s;" onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='var(--text-muted)'">
                                    <i class="fa-solid fa-external-link-alt"></i> ${sourceName}
                                </a>
                            </div>
                        </div>
                    `;
                    return html;
                }).join('');

                // Append generated HTML directly to container (to preserve Grid layout)
                container.innerHTML = htmlContent;

                // Initialize all match cards found
                cardsToInit.forEach(c => {
                    if (typeof window.initMatchCard === 'function') {
                        initMatchCard(c.id, c.data);
                    } else {
                        console.error('initMatchCard function not found on window!');
                    }
                });

            } catch (err) {
                console.error('Error loading standings:', err);
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                        <i class="fa-solid fa-exclamation-triangle" style="font-size: 2rem; color: #fca5a5;"></i>
                        <p style="margin-top: 1rem; color: var(--text-muted);">Nepodařilo se načíst tabulky.</p>
                    </div>
                `;
            }
        }

        // Load on page ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadStandings);
        } else {
            loadStandings();
        }
    </script>
</body>

</html>