<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galerie - Šachový oddíl TJ Bižuterie Jablonec</title>
    <meta name="description" content="Fotogalerie ze zápasů a akcí šachového oddílu TJ Bižuterie Jablonec.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>

<body>
    <header id="global-header"></header>

    <main>
        <section class="container" style="margin-top: 80px;">
            <h1 class="section-title">Galerie</h1>

            <div id="galleryGrid" class="card-grid">
                <!-- Loading State -->
                <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                    <div
                        style="display: inline-block; width: 40px; height: 40px; border: 4px solid rgba(212, 175, 55, 0.2); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s linear infinite;">
                    </div>
                    <p style="margin-top: 1rem; color: var(--text-muted);">Načítám galerii...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div id="galleryPagination"
                style="display: none; justify-content: center; align-items: center; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                <button id="prevPageBtn" class="btn-secondary" onclick="changePage(-1)" style="padding: 0.5rem 1rem;">
                    <i class="fa-solid fa-chevron-left"></i> Předchozí
                </button>
                <span id="pageInfo" style="color: var(--text-muted); font-size: 0.9rem;"></span>
                <button id="nextPageBtn" class="btn-secondary" onclick="changePage(1)" style="padding: 0.5rem 1rem;">
                    Další <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </section>
    </main>

    <footer id="global-footer"></footer>

    <script src="js/config.js"></script>
    <script src="js/layout-loader.js"></script>
    <script src="js/lightbox.js"></script>
    <script src="js/main.js"></script>
    <script>
        window.galleryImages = [];
        const IMAGES_PER_PAGE = 9;
        let currentPage = 1;
        let totalPages = 1;

        document.addEventListener('DOMContentLoaded', async () => {
            const grid = document.getElementById('galleryGrid');
            try {
                const res = await fetch(`${API_URL}/images/public`);
                if (!res.ok) throw new Error('Failed to load images');

                window.galleryImages = await res.json();

                if (window.galleryImages.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 4rem; background: rgba(255,255,255,0.02); border-radius: 12px; border: 1px dashed rgba(255,255,255,0.1);">
                            <i class="fa-regular fa-images" style="font-size: 3rem; color: var(--text-muted); opacity: 0.5; margin-bottom: 1rem;"></i>
                            <h3 style="margin-bottom: 0.5rem; color: var(--text-light);">Zatím žádné fotky</h3>
                            <p style="color: var(--text-muted);">Galerie je momentálně prázdná.</p>
                        </div>
                    `;
                    return;
                }

                totalPages = Math.ceil(window.galleryImages.length / IMAGES_PER_PAGE);
                renderPage();

            } catch (e) {
                console.error('Gallery load error:', e);
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #fca5a5;">
                        <i class="fa-solid fa-triangle-exclamation"></i> Nepodařilo se načíst galerii.
                    </div>
                `;
            }
        });

        function renderPage() {
            const grid = document.getElementById('galleryGrid');
            const pagination = document.getElementById('galleryPagination');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');

            const startIdx = (currentPage - 1) * IMAGES_PER_PAGE;
            const endIdx = startIdx + IMAGES_PER_PAGE;
            const pageImages = window.galleryImages.slice(startIdx, endIdx);

            grid.innerHTML = pageImages.map((img, i) => {
                const globalIndex = startIdx + i; // Pro lightbox používáme globální index
                return `
                    <div class="card" style="animation: fadeIn 0.5s ease-out;">
                        <div class="card-image" style="height: 300px; cursor: pointer; position: relative;" onclick="SJLightbox.open(window.galleryImages, ${globalIndex})">
                            <img src="${img.url}" alt="${img.altText || 'Fotografie z galerie'}" loading="lazy" style="transition: transform 0.5s ease;">
                            <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; pointer-events: none;" class="hover-overlay">
                                <i class="fa-solid fa-expand" style="font-size: 2rem; color: white;"></i>
                            </div>
                        </div>
                        <div class="card-content">
                            ${img.altText ? `<h3 class="card-title">${img.altText}</h3>` : ''}
                            <p class="card-excerpt" style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.8em; opacity: 0.7;">
                                    <i class="fa-regular fa-calendar" style="margin-right: 4px;"></i>
                                    ${new Date(img.uploadedAt).toLocaleDateString('cs-CZ')}
                                </span>
                            </p>
                        </div>
                    </div>
                `;
            }).join('');

            // Show pagination only if more than 1 page
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                pageInfo.textContent = `Stránka ${currentPage} z ${totalPages}`;
                prevBtn.disabled = currentPage === 1;
                prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
            } else {
                pagination.style.display = 'none';
            }

            // Scroll to top of gallery on page change
            document.getElementById('galleryGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function changePage(delta) {
            const newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderPage();
            }
        }
    </script>
</body>

</html>