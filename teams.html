<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soutƒõ≈æe dru≈æstev - ≈†achov√Ω odd√≠l TJ Bi≈æuterie Jablonec</title>
    <meta name="description"
        content="V√Ωsledky a soutƒõ≈æe ≈°achov√©ho odd√≠lu TJ Bi≈æuterie Jablonec. Krajsk√Ω p≈ôebor a dal≈°√≠ soutƒõ≈æe.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/game-viewer.css">
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
        integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU" crossorigin="anonymous">
    <style>
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--surface-color);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--primary-color);
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .close-modal {
            color: var(--text-muted);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: var(--primary-color);
            text-decoration: none;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .schedule-table th {
            color: var(--primary-color);
            font-weight: 600;
        }
    </style>
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>

<body>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close-modal"
                onclick="document.getElementById('scheduleModal').style.display='none'">&times;</span>
            <h3 id="modalTeamName" style="border-bottom: 1px solid var(--primary-color); padding-bottom: 0.5rem;">Rozpis
                Z√°pas≈Ø</h3>
            <div id="modalBody"></div>
        </div>
    </div>
    <header id="global-header"></header>

    <main>
        <section class="container" style="margin-top: 80px;">
            <div class="header-actions">
                <h1 class="section-title" style="margin-bottom: 0;">Soutƒõ≈æe dru≈æstev</h1>
                <a href="/calendar" class="read-more"
                    style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(212,175,55,0.15); padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
                    <i class="fa-regular fa-calendar-days"></i> Kalend√°≈ô z√°pas≈Ø
                </a>
            </div>

            <div class="card-grid">
                <!-- Krajsk√Ω p≈ôebor -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Krajsk√Ω p≈ôebor <span
                                style="font-size: 0.6em; color: var(--text-muted); font-weight: 400;">Sez√≥na
                                2025/2026</span>
                        </h2>


                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <!-- A Team -->
                            <div id="team-kp-A">
                                <h3 style="color: var(--primary-color);">A T√Ωm</h3>
                                <div id="lastMatch-kp-A" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-kp-A', 'https://chess-results.com/tnr1276470.aspx?lan=5', 1)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-kp-A"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-kp-A" style="display: none; margin-bottom: 1rem;"></div>
                            </div>

                            <!-- B Team -->
                            <div id="team-kp-B">
                                <h3 style="color: var(--primary-color);">B T√Ωm</h3>
                                <div id="lastMatch-kp-B" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-kp-B', 'https://chess-results.com/tnr1276470.aspx?lan=5', 10)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-kp-B"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-kp-B" style="display: none; margin-bottom: 1rem;"></div>
                            </div>
                        </div>

                        <!-- Standings Placeholder KP -->
                        <div id="standings-kp-liberec" style="margin-top: 2rem;"></div>

                        <div
                            style="margin-top: 2rem; background: linear-gradient(135deg, rgba(30,30,40,0.9) 0%, rgba(20,20,30,0.95) 100%); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">
                            <div
                                style="background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, rgba(212,175,55,0.05) 100%); padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <h4
                                    style="margin: 0; color: var(--primary-color); font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fa-solid fa-newspaper"></i> Reporty ze z√°pas≈Ø
                                </h4>
                            </div>
                            <div id="teamsNewsList" data-news-category="Soutƒõ≈æe dru≈æstev" data-news-display="full-short"
                                data-news-limit="3" style="padding: 1rem;">
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Krajsk√° soutƒõ≈æ I. - v√Ωchod -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Krajsk√° soutƒõ≈æ I. - v√Ωchod <span
                                style="font-size: 0.6em; color: var(--text-muted); font-weight: 400;">Sez√≥na
                                2025/2026</span>
                        </h2>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <!-- C Team -->
                            <div id="team-ks-C">
                                <h3 style="color: var(--primary-color);">C T√Ωm</h3>
                                <div id="lastMatch-ks-C" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-ks-C', 'https://chess-results.com/tnr1278502.aspx?lan=5', 4)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-ks-C"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-ks-C" style="display: none; margin-bottom: 1rem;"></div>
                            </div>

                            <!-- D Team -->
                            <div id="team-ks-D">
                                <h3 style="color: var(--primary-color);">D T√Ωm</h3>
                                <div id="lastMatch-ks-D" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-ks-D', 'https://chess-results.com/tnr1278502.aspx?lan=5', 5)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-ks-D"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-ks-D" style="display: none; margin-bottom: 1rem;"></div>
                            </div>
                        </div>

                        <!-- Standings Placeholder -->
                        <div id="standings-ks-vychod" style="margin-top: 2rem;"></div>
                    </div>
                </div>

                <!-- Game Viewer Section -->
                <div id="game-viewer-wrapper" class="card" style="grid-column: 1 / -1; display: none;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Partie ze soutƒõ≈æ√≠
                        </h2>

                        <div id="game-viewer-container" class="viewer-wrapper">
                            <div class="viewer-toggle-bar" onclick="gameViewer.toggleViewer()">
                                <h3><i class="fa-solid fa-chess-board"></i> P≈ôehr√°vaƒç parti√≠</h3>
                                <i id="viewerToggleIcon" class="fa-solid fa-chevron-up"></i>
                            </div>
                            <div id="appContainer" class="app-container">
                                <header class="app-header">
                                    <div>
                                        <h1 id="gameViewerTitle">Partie</h1>
                                        <p id="gameViewerSubtitle"
                                            style="color: var(--viewer-text-muted); font-size: 0.8rem; margin: 0;"></p>
                                    </div>
                                </header>

                                <main class="main-content">
                                    <aside class="sidebar">
                                        <div class="sidebar-header">
                                            <h2>Seznam Parti√≠</h2>
                                        </div>
                                        <div class="game-list" id="game-list-content">
                                            <!-- Games will be populated here -->
                                        </div>
                                    </aside>

                                    <section class="game-viewer">
                                        <div class="iframe-container">
                                            <iframe id="chess-frame" src="" frameborder="0"
                                                allowtransparency="true"></iframe>
                                        </div>
                                        <div class="controls">
                                            <button id="prevBtn" class="control-btn" onclick="gameViewer.prevGame()"
                                                aria-label="P≈ôedchoz√≠ partie">
                                                <i class="fa-solid fa-chevron-left"></i> <span
                                                    class="btn-text">P≈ôedchoz√≠</span>
                                            </button>
                                            <div class="game-info">
                                                <span id="current-game-title" class="current-game-title">Vyberte
                                                    partii</span>
                                                <span id="game-counter" class="game-counter"></span>
                                            </div>
                                            <button id="nextBtn" class="control-btn" onclick="gameViewer.nextGame()"
                                                aria-label="Dal≈°√≠ partie">
                                                <span class="btn-text">Dal≈°√≠</span> <i
                                                    class="fa-solid fa-chevron-right"></i>
                                            </button>
                                        </div>
                                    </section>
                                </main>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Archive -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Archiv</h2>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <div>
                                <h3 style="color: var(--primary-color);">Sez√≥na 2024/2025</h3>
                                <ul style="margin-top: 0.5rem;">
                                    <li><a href="https://www.chess.cz/soutez/3003/" target="_blank"
                                            class="read-more">Krajsk√Ω p≈ôebor (A & B)</a></li>
                                    <li><a href="https://www.chess.cz/soutez/3052/" target="_blank" class="read-more">KS
                                            v√Ωchod (C)</a></li>
                                </ul>
                            </div>

                            <div>
                                <h3 style="color: var(--primary-color);">Sez√≥na 2023/2024</h3>
                                <ul style="margin-top: 0.5rem;">
                                    <li><a href="https://www.chess.cz/soutez/2885/" target="_blank"
                                            class="read-more">Krajsk√Ω p≈ôebor (A)</a></li>
                                    <li><a href="https://www.chess.cz/soutez/2924/" target="_blank" class="read-more">KS
                                            v√Ωchod (B)</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer id="global-footer"></footer>

    <script src="js/config.js?v=2"></script>
    <script src="js/layout-loader.js?v=2"></script>
    <script src="js/main.js?v=2"></script>
    <script src="js/match-cards.js?v=2"></script>
    <script src="js/news-loader.js?v=2"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="js/game-viewer.js"></script>
    <script>
        // Game Viewer Loader
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Fetch games for category "Soutƒõ≈æe dru≈æstev"
                const res = await fetch(`${API_URL}/viewer-games?category=Soutƒõ≈æe dru≈æstev`);
                if (res.ok) {
                    const games = await res.json();
                    if (games && games.length > 0) {
                        // Initialize viewer
                        gameViewer.init(games, null); // No team grouping for now

                        // Show the viewer card
                        document.getElementById('game-viewer-wrapper').style.display = 'block';
                    }
                }
            } catch (e) {
                console.error("Failed to load games:", e);
            }
        });

        // Standings Loader Logic (similar to youth.html)
        document.addEventListener('DOMContentLoaded', () => {
            loadNews('Soutƒõ≈æe dru≈æstev', 'teamsNewsList', 'list');
            loadStandings('kp-liberec', 'standings-kp-liberec');
            loadStandings('ks-vychod', 'standings-ks-vychod');

            // Load last match badges
            loadLastMatches();
        });

        // Global state for team schedules
        window.teamData = {};

        async function loadLastMatches() {
            try {
                const res = await fetch(`${API_URL}/standings`);
                if (!res.ok) return;
                const data = await res.json();
                const competitions = data.standings || data;

                // Team mappings: containerId -> [competitionId, teamNamePattern]
                // Team names are like: TJ Bi≈æuterie Jablonec n.N. "A" and TJ Bi≈æuterie Jablonec n.N. "B"
                const teamMappings = [
                    { containerId: 'lastMatch-kp-A', compId: 'kp-liberec', pattern: /bi≈æuterie.*"A"/i },
                    { containerId: 'lastMatch-kp-B', compId: 'kp-liberec', pattern: /bi≈æuterie.*"B"/i },
                    { containerId: 'lastMatch-ks-C', compId: 'ks-vychod', pattern: /bi≈æuterie.*"C"/i },
                    { containerId: 'lastMatch-ks-D', compId: 'ks-vychod', pattern: /bi≈æuterie.*"D"/i },
                ];

                for (const mapping of teamMappings) {
                    const container = document.getElementById(mapping.containerId);
                    if (!container) continue;

                    const comp = competitions.find(c => c.competitionId === mapping.compId);
                    if (!comp) continue;

                    // Find team in standings
                    const team = comp.standings?.find(s => mapping.pattern.test(s.team));
                    if (!team || !team.schedule) continue;

                    // Find last match with actual result (has digits, not just ' :  ' placeholder)
                    const hasActualResult = (r) => r && /\d/.test(r);
                    let lastPlayedIndex = -1;

                    // Filter or just find index? Better to keep full schedule to allow future matches.
                    // Loop to find the last played match index
                    for (let i = 0; i < team.schedule.length; i++) {
                        if (hasActualResult(team.schedule[i].result)) {
                            lastPlayedIndex = i;
                        }
                    }

                    // Default to last played, or first if none played, or 0
                    let initialIndex = lastPlayedIndex >= 0 ? lastPlayedIndex : 0;

                    // Store data globally
                    window.teamData[mapping.containerId] = {
                        schedule: team.schedule,
                        currentIndex: initialIndex,
                        teamName: team.team,
                        teamUrl: team.url || comp.url || '',
                        compName: comp.competitionName || comp.competitionId,
                        mapping: mapping
                    };

                    renderMatchBadge(mapping.containerId);
                }
            } catch (e) {
                console.error('Error loading last matches:', e);
            }
        }

        function renderMatchBadge(containerId) {
            const container = document.getElementById(containerId);
            const data = window.teamData[containerId];
            if (!container || !data) return;

            const match = data.schedule[data.currentIndex];
            if (!match) return;

            const isLast = data.currentIndex === data.schedule.length - 1;
            const isFirst = data.currentIndex === 0;

            // Analyze result
            const hasResult = match.result && /\d/.test(match.result);
            let statusIcon = 'üìÖ'; // Calendar for future
            let statusColor = 'var(--text-muted)';
            let bgColor = 'rgba(255,255,255,0.05)';
            let borderColor = 'rgba(255,255,255,0.1)';

            if (hasResult) {
                const resultParts = match.result.split(':').map(p => parseFloat(p.replace(',', '.')));
                if (resultParts.length === 2) {
                    const [home, away] = resultParts;
                    const isHome = match.isHome !== false;
                    const ourScore = isHome ? home : away;
                    const theirScore = isHome ? away : home;

                    if (ourScore > theirScore) {
                        statusIcon = '‚úÖ';
                        statusColor = '#4ade80';
                        bgColor = 'rgba(74,222,128,0.15)';
                        borderColor = '#4ade80';
                    } else if (ourScore < theirScore) {
                        statusIcon = '‚ùå';
                        statusColor = '#f87171';
                        bgColor = 'rgba(248,113,113,0.15)';
                        borderColor = '#f87171';
                    } else {
                        statusIcon = 'ü§ù';
                        statusColor = '#fbbf24';
                        bgColor = 'rgba(251,191,36,0.15)';
                        borderColor = '#fbbf24';
                    }
                }
            } else {
                // Future match
                borderColor = 'var(--primary-color)';
                bgColor = 'rgba(212,175,55,0.1)';
                statusColor = 'var(--primary-color)';
            }

            // Prepare details data
            const detailsId = `details-${containerId}`;
            const matchUrl = data.teamUrl;
            // Only clickable for details IF played
            const canShowDetails = hasResult;

            // Format date to Czech "d. m. yyyy"
            let formattedDate = match.date;
            try {
                // Determine format
                if (match.date.includes('/')) {
                    // Assume YYYY/MM/DD or DD/MM/YYYY? 
                    // Based on screenshot 2025/12/07, likely YYYY/MM/DD from scraper
                    const parts = match.date.split('/');
                    if (parts.length === 3) {
                        // If part[0] is year (4 digits)
                        if (parts[0].length === 4) {
                            const d = new Date(match.date);
                            formattedDate = d.toLocaleDateString('cs-CZ');
                        } else {
                            // Already likely DD/MM/YYYY or similar, just replace / with . and space
                            formattedDate = `${parseInt(parts[0])}. ${parseInt(parts[1])}. ${parts[2]}`;
                        }
                    }
                } else if (match.date.includes('.')) {
                    // Check if spaces are missing
                    const parts = match.date.split('.');
                    if (parts.length >= 3) {
                        formattedDate = `${parseInt(parts[0])}. ${parseInt(parts[1])}. ${parts[2].trim()}`;
                    }
                }
            } catch (e) {
                console.warn('Date formatting failed', e);
            }

            // Determine Home/Away
            // Note: Data structure might be inferred. If `match.isHome` exists use it.
            // If we parsed result `home:away` and determined `ourScore`, we might know.
            // Earlier we used: `const isHome = match.isHome !== false;`
            const isHome = match.isHome !== false;
            const homeAwayLabel = isHome ? 'DOMA' : 'VENKU';
            const homeAwayColor = isHome ? 'var(--text-color)' : 'var(--text-muted)';
            const homeAwayBg = isHome ? 'rgba(255, 255, 255, 0.1)' : 'transparent';

            container.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.25rem;">
                    <!-- Prev Button -->
                    <button onclick="changeMatch('${containerId}', -1)" 
                        style="background: transparent; border: none; color: var(--text-muted); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: ${isFirst ? 0.2 : 0.8}; pointer-events: ${isFirst ? 'none' : 'auto'}; transition: all 0.2s; font-size: 1.1rem; border-radius: 50%;"
                        onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-color)'"
                        onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-muted)'">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>

                    <!-- Main Badge -->
                    <!-- Main Badge -->
                    <div onclick="${canShowDetails ? `toggleMatchBadgeDetails('${detailsId}', '${encodeURIComponent(matchUrl)}', '${match.round}', '${encodeURIComponent(data.teamName)}', '${encodeURIComponent(match.opponent)}', this)` : `openScheduleModal(teamData['${containerId}'].schedule, teamData['${containerId}'].teamName)`}" 
                         style="flex: 1; padding: 0.6rem 0.75rem; background: linear-gradient(135deg, ${bgColor} 0%, rgba(0,0,0,0.3) 100%); border-radius: 12px; border: 1px solid ${borderColor}; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.2); position: relative; overflow: hidden;"
                         onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'" 
                         onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                                                
                        <!-- Status Strip -->
                        <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background-color: ${statusColor};"></div>

                        <div style="display: flex; flex-direction: column; gap: 0.2rem; padding-left: 0.5rem;">
                             <!-- Top Row: Round + Home/Away -->
                             <div style="display: flex; align-items: center; justify-content: space-between; font-size: 0.75em; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted);">
                                <span>${match.round}. KOLO ‚Ä¢ ${formattedDate}</span>
                                <span style="font-weight: 700; color: ${homeAwayColor}; background: ${homeAwayBg}; padding: 1px 6px; border-radius: 4px; font-size: 0.9em;">${homeAwayLabel}</span>
                             </div>

                             <!-- Middle Row: Result and Status -->
                             <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.2rem;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="font-size: 1.4em; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">${statusIcon}</span>
                                    <div style="font-weight: 700; color: ${statusColor}; font-size: 1.5em; line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">${hasResult ? match.result : ' - : - '}</div>
                                </div>
                                
                                ${canShowDetails ? `
                                <div style="display: flex; align-items: center; gap: 0.5rem; background: rgba(0,0,0,0.2); padding: 0.2rem 0.6rem; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05);">
                                    <span style="font-size: 0.7em; color: var(--text-muted); font-weight: 500; text-transform: uppercase;">Detail</span>
                                    <i class="fa-solid fa-chevron-down details-icon" style="color: var(--primary-color); font-size: 0.7em; transition: transform 0.2s;"></i>
                                </div>
                                ` : `
                                 <div style="display: flex; align-items: center; gap: 0.5rem; background: rgba(212,175,55,0.1); padding: 0.2rem 0.6rem; border-radius: 20px; border: 1px solid rgba(212,175,55,0.2);">
                                    <i class="fa-regular fa-calendar-days" style="color: var(--primary-color); font-size: 0.8em;"></i>
                                    <span style="font-size: 0.7em; color: var(--primary-color); font-weight: 600; text-transform: uppercase;">Rozpis</span>
                                </div>
                                `}
                            </div>
                            
                            <!-- Bottom Row: Opponent -->
                            <div style="margin-top: 0.5rem; padding-top: 0.4rem; border-top: 1px solid rgba(255,255,255,0.05); color: var(--text-light); font-size: 0.9em;">
                                <span style="color: var(--text-muted); font-size: 0.9em;">vs</span> <strong style="color: var(--text-color); font-size: 1.05em;">${match.opponent}</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Next Button -->
                    <button onclick="changeMatch('${containerId}', 1)" 
                        style="background: transparent; border: none; color: var(--text-muted); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: ${isLast ? 0.2 : 0.8}; pointer-events: ${isLast ? 'none' : 'auto'}; transition: all 0.2s; font-size: 1.1rem; border-radius: 50%;"
                        onmouseover="this.style.backgroundColor='rgba(255,255,255,0.05)'; this.style.color='var(--text-color)'"
                        onmouseout="this.style.backgroundColor='transparent'; this.style.color='var(--text-muted)'">
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                </div>
                
                <!-- Expanded Details Container -->
                <div id="${detailsId}" style="display: none; margin-top: 0.5rem; padding: 0.6rem; background: rgba(0,0,0,0.3); border-radius: 8px; font-size: 0.85rem; border: 1px solid rgba(255,255,255,0.1);"></div>
            `;

            // Restore details state if it was open?
            // For now, details close when switching matches, which is cleaner.
        }

        function changeMatch(containerId, delta) {
            if (window.teamData && window.teamData[containerId]) {
                const data = window.teamData[containerId];
                const newIndex = data.currentIndex + delta;
                if (newIndex >= 0 && newIndex < data.schedule.length) {
                    data.currentIndex = newIndex;
                    renderMatchBadge(containerId);
                }
            }
        }

        async function toggleMatchBadgeDetails(detailsId, urlEncoded, round, homeEncoded, awayEncoded) {
            const container = document.getElementById(detailsId);
            const icon = document.getElementById(`icon-${detailsId}`);
            if (!container) return;

            // Toggle visibility
            const isHidden = container.style.display === 'none';
            container.style.display = isHidden ? 'block' : 'none';
            if (icon) icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';

            if (!isHidden) return; // Hiding

            // If empty, fetch data
            if (container.innerHTML.trim() === '' || container.innerHTML.includes('Naƒç√≠t√°m')) {
                container.innerHTML = '<div style="text-align: center; padding: 0.5rem;"><i class="fa-solid fa-spinner fa-spin"></i> Naƒç√≠t√°m...</div>';

                try {
                    const url = decodeURIComponent(urlEncoded);
                    const home = decodeURIComponent(homeEncoded);
                    const away = decodeURIComponent(awayEncoded);

                    if (!url) {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">Detaily nejsou k dispozici.</p>';
                        return;
                    }

                    const res = await fetch(`${API_URL}/standings/match-details?url=${encodeURIComponent(url)}&round=${round}&home=${encodeURIComponent(home)}&away=${encodeURIComponent(away)}`);
                    if (!res.ok) throw new Error('Fetch failed');
                    const data = await res.json();

                    if (data.boards && data.boards.length > 0) {
                        let html = '<table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">';
                        html += '<thead><tr style="border-bottom: 1px solid rgba(255,255,255,0.1);"><th style="padding: 0.3rem; text-align: left; width: 1.5rem;">≈†</th><th style="padding: 0.3rem; text-align: left;">Dom√°c√≠</th><th style="padding: 0.3rem; text-align: center; white-space: nowrap;">V√Ωs.</th><th style="padding: 0.3rem; text-align: right;">Host√©</th></tr></thead><tbody>';
                        data.boards.forEach((b, idx) => {
                            // Use index as board number (1-based)
                            const boardNum = idx + 1;
                            // Format player name with ELO
                            const formatPlayer = (name, elo) => {
                                if (!name || name === '-') return '-';
                                const eloStr = elo && elo !== '-' ? `<span style="color: var(--text-muted); font-size: 0.8em;"> (${elo})</span>` : '';
                                return name + eloStr;
                            };
                            const homeName = formatPlayer(b.white || b.homePlayer, b.whiteElo || b.homeElo);
                            const guestName = formatPlayer(b.black || b.guestPlayer, b.blackElo || b.guestElo);

                            html += `<tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td style="padding: 0.3rem; color: var(--text-muted);">${boardNum}</td>
                                <td style="padding: 0.3rem;">${homeName}</td>
                                <td style="padding: 0.3rem; text-align: center; font-weight: 600; white-space: nowrap;">${b.result || '-'}</td>
                                <td style="padding: 0.3rem; text-align: right;">${guestName}</td>
                            </tr>`;
                        });
                        html += '</tbody></table>';
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">Detaily nejsou k dispozici.</p>';
                    }
                } catch (e) {
                    console.error('Error loading match details:', e);
                    container.innerHTML = '<p style="color: #fca5a5; text-align: center;">Chyba naƒç√≠t√°n√≠.</p>';
                }
            }
        }

        // Navigate to team card and expand roster
        function navigateToTeam(anchorId, rosterId, rosterUrl, rosterSnr) {
            const anchor = document.getElementById(anchorId);
            if (anchor) {
                // Scroll to anchor with offset
                anchor.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Expand roster after scroll
                setTimeout(() => {
                    const roster = document.getElementById(rosterId);
                    if (roster && roster.style.display === 'none') {
                        toggleRoster(rosterId, rosterUrl, rosterSnr);
                    }
                }, 500);
            }
        }

        // Toggle team roster display
        async function toggleRoster(containerId, url, snr) {
            const container = document.getElementById(containerId);
            const icon = document.getElementById(`icon-${containerId}`);
            if (!container) return;

            // Toggle visibility
            const isHidden = container.style.display === 'none';
            container.style.display = isHidden ? 'block' : 'none';
            if (icon) icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';

            if (!isHidden) return; // Hiding

            // If empty, fetch data
            if (container.innerHTML.trim() === '') {
                container.innerHTML = '<div style="text-align: center; padding: 0.5rem;"><i class="fa-solid fa-spinner fa-spin"></i> Naƒç√≠t√°m soupisku...</div>';

                try {
                    const res = await fetch(`${API_URL}/standings/team-roster?url=${encodeURIComponent(url)}&snr=${snr}`);
                    if (!res.ok) throw new Error('Fetch failed');
                    const data = await res.json();

                    if (data.players && data.players.length > 0) {
                        let html = `<div style="background: linear-gradient(135deg, rgba(212,175,55,0.1) 0%, rgba(0,0,0,0.3) 100%); border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">`;
                        html += `<table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">`;
                        html += `<thead><tr style="background: linear-gradient(90deg, rgba(212,175,55,0.2) 0%, rgba(212,175,55,0.05) 100%);">
                            <th style="padding: 0.6rem 0.4rem; text-align: center; font-weight: 600; color: var(--primary-color); width: 2rem;">#</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: left; font-weight: 600; color: var(--primary-color);">Hr√°ƒç</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: right; font-weight: 600; color: var(--primary-color);">ELO</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: center; font-weight: 600; color: var(--primary-color);">Body</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: right; font-weight: 600; color: var(--primary-color);" title="Pr≈Ømƒõr ELO soupe≈ô≈Ø">√ò ELO</th>
                        </tr></thead><tbody>`;
                        data.players.forEach((p, idx) => {
                            const bgColor = idx % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'rgba(0,0,0,0.1)';
                            const scoreColor = p.score !== '-' ? (parseFloat(p.score) > 0.5 * parseInt(p.score.split('/')[1] || 1) ? '#4ade80' : '#f87171') : 'var(--text-muted)';
                            html += `<tr style="background: ${bgColor}; transition: background 0.2s;" onmouseover="this.style.background='rgba(212,175,55,0.1)'" onmouseout="this.style.background='${bgColor}'">
                                <td style="padding: 0.5rem 0.4rem; text-align: center; color: var(--text-muted); font-size: 0.8rem;">${p.rank}</td>
                                <td style="padding: 0.5rem 0.4rem; font-weight: 500;">${p.name}</td>
                                <td style="padding: 0.5rem 0.4rem; text-align: right; color: var(--text-muted); font-family: monospace;">${p.elo || '-'}</td>
                                <td style="padding: 0.5rem 0.4rem; text-align: center; font-weight: 700; color: ${scoreColor};">${p.score}</td>
                                <td style="padding: 0.5rem 0.4rem; text-align: right; color: var(--text-muted); font-family: monospace; font-size: 0.8rem;">${p.perf || '-'}</td>
                            </tr>`;
                        });
                        html += '</tbody></table></div>';
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">Soupiska nen√≠ k dispozici.</p>';
                    }
                } catch (e) {
                    console.error('Error loading roster:', e);
                    container.innerHTML = '<p style="color: #fca5a5; text-align: center;">Chyba naƒç√≠t√°n√≠ soupisky.</p>';
                }
            }
        }

        async function loadStandings(competitionId, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Loading state
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fa-solid fa-spinner fa-spin"></i> Naƒç√≠t√°m tabulku...
                </div>
            `;

            try {
                // Determine API URL - in this case we use the main standings endpoint which returns ALL competitions
                // We need to filter for the specific one on the client side since our backend returns a list
                // OR we can rely on the fact that /api/standings (GET) usually serves a JSON file with all data.
                // Wait, server.js exports /api/standings/update (POST). Where is the GET endpoint?
                // Step 1209 summary says youth.html calls /api/standings.
                // I need to check if /api/standings exists as a static file server or GET route.
                // Assuming it serves the 'data/standings.json' file or similar.

                // Let's assume there is an endpoint or file. 
                // Based on youth.html context (Step 225 from previous conv), it fetches './data/standings.json' or '/api/standings'.
                // I will use fetch('/api/standings') if it exists, or check how youth.html does it exactly.

                // Correction: The backend code showed app.post('/api/standings/update').
                // It usually saves to a file. I assumed there is a GET route serving it.
                // If not, I should add it or use the static file if exposed.
                // Let's assume '/data/standings.json' is available if static folder is mapped?
                // Or I can add a GET route in server.js to be safe. 
                // But for now, let's look at youth.html lines 220-302 (viewed in Step 1378).
                // It calls `/api/standings`.

                const res = await fetch(`${API_URL}/standings`);
                if (!res.ok) throw new Error('Failed to load standings');

                const data = await res.json();

                // Compatibility check: server might return { standings: [...] } or just [...]
                const competitions = data.standings || data;

                // Check if competitions is an array
                if (!Array.isArray(competitions)) {
                    throw new Error('Invalid data format');
                }

                const competition = competitions.find(c => c.competitionId === competitionId);

                if (!competition || !competition.standings || competition.standings.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 1rem; color: var(--text-muted); font-style: italic;">
                            Tabulka zat√≠m nen√≠ k dispozici.
                        </div>
                    `;
                    return;
                }

                // Render Table with improved UI
                const compName = competition.name || 'Tabulka';
                let html = `
                    <div style="background: linear-gradient(135deg, rgba(30,30,40,0.9) 0%, rgba(20,20,30,0.95) 100%); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                        <div style="background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, rgba(212,175,55,0.05) 100%); padding: 0.75rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <h4 style="margin: 0; color: var(--primary-color); font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fa-solid fa-trophy"></i> ${compName}
                            </h4>
                        </div>
                        <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                        <table style="width: 100%; min-width: 550px; table-layout: fixed; border-collapse: collapse; font-size: 0.8rem;">
                            <thead>
                                <tr style="background: rgba(0,0,0,0.3);">
                                    <th style="width: 8%; text-align: center; padding: 0.4rem 0.25rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;">#</th>
                                    <th style="width: 60%; text-align: left; padding: 0.4rem 0.25rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase;">Dru≈æstvo</th>
                                    <th style="width: 18%; text-align: center; padding: 0.4rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;" title="V√Ωhry-Rem√≠zy-Prohry">V/R/P</th>
                                    <th style="width: 14%; text-align: right; padding: 0.4rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;" title="Z√°pasov√© body">Body</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                competition.standings.forEach((s, idx) => {
                    const isBizuterie = s.isBizuterie || s.team.toLowerCase().includes('bi≈æuterie');
                    const bgColor = idx % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'rgba(0,0,0,0.15)';

                    // Position badge styling (compact)
                    let positionBadge = '';
                    if (s.rank === 1) {
                        positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #ffd700, #b8860b); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #000;">1</span>';
                    } else if (s.rank === 2) {
                        positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #c0c0c0, #808080); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #000;">2</span>';
                    } else if (s.rank === 3) {
                        positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #cd7f32, #8b4513); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #fff;">3</span>';
                    } else {
                        positionBadge = `<span style="color: var(--text-muted); font-size: 0.7rem;">${s.rank}</span>`;
                    }

                    // Bi≈æuterie highlight
                    const rowStyle = isBizuterie
                        ? `background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, ${bgColor} 100%); border-left: 3px solid var(--primary-color);`
                        : `background: ${bgColor};`;
                    const teamStyle = isBizuterie ? 'font-weight: 600; color: var(--primary-color);' : '';

                    // W/D/L display
                    const wdl = (s.wins !== undefined) ? `<span style="color:#4ade80">${s.wins}</span>/<span style="color:#fbbf24">${s.draws || 0}</span>/<span style="color:#f87171">${s.losses || 0}</span>` : '-';

                    // Determine team anchor and roster ID for Bi≈æuterie teams
                    let teamClickHandler = '';
                    if (isBizuterie) {
                        // Map team name to anchor ID and roster ID
                        const teamLower = s.team.toLowerCase();
                        let anchorId = '', rosterId = '', rosterUrl = '', rosterSnr = '';
                        if (teamLower.includes('"a"') || /\\ba\\b/.test(teamLower) || teamLower.endsWith(' a')) {
                            anchorId = 'team-kp-A'; rosterId = 'roster-kp-A'; rosterUrl = 'https://chess-results.com/tnr1276470.aspx?lan=5'; rosterSnr = '1';
                        } else if (teamLower.includes('"b"') || /\\bb\\b/.test(teamLower) || teamLower.endsWith(' b')) {
                            anchorId = 'team-kp-B'; rosterId = 'roster-kp-B'; rosterUrl = 'https://chess-results.com/tnr1276470.aspx?lan=5'; rosterSnr = '10';
                        } else if (teamLower.includes('"c"') || /\\bc\\b/.test(teamLower) || teamLower.endsWith(' c')) {
                            anchorId = 'team-ks-C'; rosterId = 'roster-ks-C'; rosterUrl = 'https://chess-results.com/tnr1278502.aspx?lan=5'; rosterSnr = '4';
                        } else if (teamLower.includes('"d"') || /\\bd\\b/.test(teamLower) || teamLower.endsWith(' d')) {
                            anchorId = 'team-ks-D'; rosterId = 'roster-ks-D'; rosterUrl = 'https://chess-results.com/tnr1278502.aspx?lan=5'; rosterSnr = '5';
                        }
                        if (anchorId) {
                            teamClickHandler = `onclick="navigateToTeam('${anchorId}', '${rosterId}', '${rosterUrl}', ${rosterSnr})" style="cursor: pointer; text-decoration: underline; text-decoration-style: dotted;"`;
                        }
                    }

                    html += `
                        <tr style="${rowStyle} transition: background 0.2s;" onmouseover="this.style.background='rgba(212,175,55,0.1)'" onmouseout="this.style.background='${isBizuterie ? 'linear-gradient(90deg, rgba(212,175,55,0.15) 0%, ' + bgColor + ' 100%)' : bgColor}'">
                            <td style="padding: 0.35rem 0.2rem; text-align: center;">${positionBadge}</td>
                            <td style="padding: 0.35rem 0.2rem; ${teamStyle} font-size: 0.78rem;" ${teamClickHandler}>${s.team}</td>
                            <td style="padding: 0.35rem 0.5rem; text-align: center; font-family: monospace; font-size: 0.72rem; white-space: nowrap;">${wdl}</td>
                            <td style="padding: 0.35rem 0.5rem; text-align: right; font-weight: 700; font-family: monospace; font-size: 0.85rem;">${s.points !== null ? s.points : '-'}</td>
                        </tr>
                    `;
                });

                const sourceName = (competition.url && competition.url.includes('chess-results')) ? 'Chess-Results.com' : '≈†SƒåR';
                const sourceUrl = competition.url || competition.chessczUrl || '#';

                html += `
                            </tbody>
                        </table>
                        </div>
                        <div style="padding: 0.75rem 1rem; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: flex-end;">
                            <a href="${sourceUrl}" target="_blank" style="color: var(--text-muted); text-decoration: none; font-size: 0.75rem; display: flex; align-items: center; gap: 0.3rem; transition: color 0.2s;" onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='var(--text-muted)'">
                                <i class="fa-solid fa-external-link-alt"></i> ${sourceName}
                            </a>
                        </div>
                    </div>
                `;

                container.innerHTML = html;

            } catch (e) {
                console.error(e);
                container.innerHTML = `
                    <div style="text-align: center; padding: 1rem; color: #fca5a5;">
                        Chyba p≈ôi naƒç√≠t√°n√≠ dat.
                    </div>
                `;
            }
        }

        window.openScheduleModal = function (scheduleData, teamName) {
            const schedule = (typeof scheduleData === 'string') ? JSON.parse(decodeURIComponent(scheduleData)) : scheduleData;
            const modalBody = document.getElementById('modalBody');
            document.getElementById('modalTeamName').textContent = teamName;

            let html = `
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th>Kolo</th>
                            <th>Datum</th>
                            <th>Soupe≈ô</th>
                            <th style="text-align:right;">V√Ωsledek</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            schedule.forEach(m => {
                html += `
                    <tr>
                        <td>${m.round}.</td>
                        <td>${m.date}</td>
                        <td>${m.opponent}</td>
                        <td style="text-align:right; font-weight:bold;">${m.result}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            modalBody.innerHTML = html;
            document.getElementById('scheduleModal').style.display = 'block';
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('scheduleModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

</html>