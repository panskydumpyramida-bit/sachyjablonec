<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soutěže družstev - Šachový oddíl TJ Bižuterie Jablonec</title>
    <meta name="description"
        content="Výsledky a soutěže šachového oddílu TJ Bižuterie Jablonec. Krajský přebor a další soutěže.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--surface-color);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--primary-color);
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .close-modal {
            color: var(--text-muted);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: var(--primary-color);
            text-decoration: none;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .schedule-table th {
            color: var(--primary-color);
            font-weight: 600;
        }
    </style>
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>

<body>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close-modal"
                onclick="document.getElementById('scheduleModal').style.display='none'">&times;</span>
            <h3 id="modalTeamName" style="border-bottom: 1px solid var(--primary-color); padding-bottom: 0.5rem;">Rozpis
                Zápasů</h3>
            <div id="modalBody"></div>
        </div>
    </div>
    <header id="global-header"></header>

    <main>
        <section class="container" style="margin-top: 80px;">
            <div class="header-actions">
                <h1 class="section-title" style="margin-bottom: 0;">Soutěže družstev</h1>
                <a href="calendar.html" class="read-more"
                    style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(212,175,55,0.15); padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid rgba(212,175,55,0.3);">
                    <i class="fa-regular fa-calendar-days"></i> Kalendář zápasů
                </a>
            </div>

            <div class="card-grid">
                <!-- Krajský přebor -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Krajský přebor <span
                                style="font-size: 0.6em; color: var(--text-muted); font-weight: 400;">Sezóna
                                2025/2026</span>
                        </h2>


                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <!-- A Team -->
                            <div id="team-kp-A">
                                <h3 style="color: var(--primary-color);">A Tým</h3>
                                <div id="lastMatch-kp-A" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-kp-A', 'https://chess-results.com/tnr1276470.aspx?lan=5', 1)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-kp-A"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-kp-A" style="display: none; margin-bottom: 1rem;"></div>
                            </div>

                            <!-- B Team -->
                            <div id="team-kp-B">
                                <h3 style="color: var(--primary-color);">B Tým</h3>
                                <div id="lastMatch-kp-B" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-kp-B', 'https://chess-results.com/tnr1276470.aspx?lan=5', 10)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-kp-B"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-kp-B" style="display: none; margin-bottom: 1rem;"></div>
                            </div>
                        </div>

                        <!-- Standings Placeholder KP -->
                        <div id="standings-kp-liberec" style="margin-top: 2rem;"></div>

                        <div
                            style="margin-top: 2rem; background: linear-gradient(135deg, rgba(30,30,40,0.9) 0%, rgba(20,20,30,0.95) 100%); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">
                            <div
                                style="background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, rgba(212,175,55,0.05) 100%); padding: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <h4
                                    style="margin: 0; color: var(--primary-color); font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fa-solid fa-newspaper"></i> Reporty ze zápasů
                                </h4>
                            </div>
                            <div id="teamsNewsList" data-news-category="Soutěže družstev" data-news-display="full-short"
                                style="padding: 1rem;">
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Krajská soutěž I. - východ -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Krajská soutěž I. - východ <span
                                style="font-size: 0.6em; color: var(--text-muted); font-weight: 400;">Sezóna
                                2025/2026</span>
                        </h2>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <!-- C Team -->
                            <div id="team-ks-C">
                                <h3 style="color: var(--primary-color);">C Tým</h3>
                                <div id="lastMatch-ks-C" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-ks-C', 'https://chess-results.com/tnr1278502.aspx?lan=5', 4)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-ks-C"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-ks-C" style="display: none; margin-bottom: 1rem;"></div>
                            </div>

                            <!-- D Team -->
                            <div id="team-ks-D">
                                <h3 style="color: var(--primary-color);">D Tým</h3>
                                <div id="lastMatch-ks-D" class="last-match-badge"
                                    style="margin-bottom: 0.75rem; font-size: 0.9rem;"></div>

                                <!-- Roster toggle -->
                                <!-- Roster toggle -->
                                <div style="display: flex; justify-content: center;">
                                    <button
                                        onclick="toggleRoster('roster-ks-D', 'https://chess-results.com/tnr1278502.aspx?lan=5', 5)"
                                        class="read-more"
                                        style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 50px; cursor: pointer; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.2s;">
                                        <i class="fa-solid fa-users"></i> Soupiska
                                        <i class="fa-solid fa-chevron-down" id="icon-roster-ks-D"
                                            style="font-size: 0.7em; transition: transform 0.2s;"></i>
                                    </button>
                                </div>
                                <div id="roster-ks-D" style="display: none; margin-bottom: 1rem;"></div>
                            </div>
                        </div>

                        <!-- Standings Placeholder -->
                        <div id="standings-ks-vychod" style="margin-top: 2rem;"></div>
                    </div>
                </div>

                <!-- Archive -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-content">
                        <h2
                            style="margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
                            Archiv</h2>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            <div>
                                <h3 style="color: var(--primary-color);">Sezóna 2024/2025</h3>
                                <ul style="margin-top: 0.5rem;">
                                    <li><a href="https://www.chess.cz/soutez/3003/" target="_blank"
                                            class="read-more">Krajský přebor (A & B)</a></li>
                                    <li><a href="https://www.chess.cz/soutez/3052/" target="_blank" class="read-more">KS
                                            východ (C)</a></li>
                                </ul>
                            </div>

                            <div>
                                <h3 style="color: var(--primary-color);">Sezóna 2023/2024</h3>
                                <ul style="margin-top: 0.5rem;">
                                    <li><a href="https://www.chess.cz/soutez/2885/" target="_blank"
                                            class="read-more">Krajský přebor (A)</a></li>
                                    <li><a href="https://www.chess.cz/soutez/2924/" target="_blank" class="read-more">KS
                                            východ (B)</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer id="global-footer"></footer>

    <script src="js/config.js"></script>
    <script src="js/layout-loader.js"></script>
    <script src="js/main.js"></script>
    <script src="js/match-cards.js"></script>
    <script>
        // Standings Loader Logic (similar to youth.html)
        document.addEventListener('DOMContentLoaded', () => {
            loadNews({ containerId: 'teamsNewsList', category: 'Soutěže družstev', displayMode: 'full-short' });
            loadStandings('kp-liberec', 'standings-kp-liberec');
            loadStandings('ks-vychod', 'standings-ks-vychod');

            // Load last match badges
            loadLastMatches();
        });

        // Global state for team schedules
        window.teamData = {};

        async function loadLastMatches() {
            try {
                const res = await fetch(`${API_URL}/standings`);
                if (!res.ok) return;
                const data = await res.json();
                const competitions = data.standings || data;

                // Team mappings: containerId -> [competitionId, teamNamePattern]
                const teamMappings = [
                    { containerId: 'lastMatch-kp-A', compId: 'kp-liberec', pattern: /bižuterie.*a\b/i },
                    { containerId: 'lastMatch-kp-B', compId: 'kp-liberec', pattern: /bižuterie.*b\b/i },
                    { containerId: 'lastMatch-ks-C', compId: 'ks-vychod', pattern: /bižuterie.*(c\b|\"c\")/i },
                    { containerId: 'lastMatch-ks-D', compId: 'ks-vychod', pattern: /bižuterie.*(d\b|\"d\")/i },
                ];

                for (const mapping of teamMappings) {
                    const container = document.getElementById(mapping.containerId);
                    if (!container) continue;

                    const comp = competitions.find(c => c.competitionId === mapping.compId);
                    if (!comp) continue;

                    // Find team in standings
                    const team = comp.standings?.find(s => mapping.pattern.test(s.team));
                    if (!team || !team.schedule) continue;

                    // Init card logic using the helper from match-cards.js or just manual set
                    // We can use the initMatchCard helper to reuse code for finding the last played match!

                    initMatchCard(mapping.containerId, {
                        schedule: team.schedule,
                        teamName: team.team,
                        teamUrl: team.url || comp.url || '',
                        compName: comp.competitionName || comp.competitionId,
                        mapping: mapping
                    });
                }
            } catch (e) {
                console.error('Error loading last matches:', e);
            }
        }

        // Navigate to team card and expand roster
        function navigateToTeam(anchorId, rosterId, rosterUrl, rosterSnr) {
            const anchor = document.getElementById(anchorId);
            if (anchor) {
                // Scroll to anchor with offset
                anchor.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Expand roster after scroll
                setTimeout(() => {
                    const roster = document.getElementById(rosterId);
                    if (roster && roster.style.display === 'none') {
                        toggleRoster(rosterId, rosterUrl, rosterSnr);
                    }
                }, 500);
            }
        }

        // Toggle team roster display
        async function toggleRoster(containerId, url, snr) {
            const container = document.getElementById(containerId);
            const icon = document.getElementById(`icon-${containerId}`);
            if (!container) return;

            // Toggle visibility
            const isHidden = container.style.display === 'none';
            container.style.display = isHidden ? 'block' : 'none';
            if (icon) icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';

            if (!isHidden) return; // Hiding

            // If empty, fetch data
            if (container.innerHTML.trim() === '') {
                container.innerHTML = '<div style="text-align: center; padding: 0.5rem;"><i class="fa-solid fa-spinner fa-spin"></i> Načítám soupisku...</div>';

                try {
                    const res = await fetch(`${API_URL}/standings/team-roster?url=${encodeURIComponent(url)}&snr=${snr}`);
                    if (!res.ok) throw new Error('Fetch failed');
                    const data = await res.json();

                    if (data.players && data.players.length > 0) {
                        let html = `<div style="background: linear-gradient(135deg, rgba(212,175,55,0.1) 0%, rgba(0,0,0,0.3) 100%); border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">`;
                        html += `<table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">`;
                        html += `<thead><tr style="background: linear-gradient(90deg, rgba(212,175,55,0.2) 0%, rgba(212,175,55,0.05) 100%);">
                            <th style="padding: 0.6rem 0.4rem; text-align: center; font-weight: 600; color: var(--primary-color);">#</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: left; font-weight: 600; color: var(--primary-color);">Hráč</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: right; font-weight: 600; color: var(--primary-color);">ELO</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: center; font-weight: 600; color: var(--primary-color);">Body</th>
                            <th style="padding: 0.6rem 0.4rem; text-align: right; font-weight: 600; color: var(--primary-color);" title="Průměr ELO soupeřů">Ø ELO</th>
                        </tr></thead><tbody>`;
                        data.players.forEach((p, idx) => {
                            const bgColor = idx % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'rgba(0,0,0,0.1)';
                            const eloDiff = p.eloDiff && p.eloDiff !== '0' ? ` <span style="font-size: 0.7em; color: ${p.eloDiff.startsWith('+') ? '#4ade80' : '#f87171'}">(${p.eloDiff})</span>` : '';
                            html += `<tr style="background: ${bgColor}; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td style="padding: 0.4rem; text-align: center; color: var(--text-muted);">${p.board || (idx + 1)}</td>
                                <td style="padding: 0.4rem; font-weight: 500;">${p.name}</td>
                                <td style="padding: 0.4rem; text-align: right; font-family: monospace;">${p.elo || '-'}</td>
                                <td style="padding: 0.4rem; text-align: center; font-weight: 700; color: var(--text-light);">${p.points}${eloDiff}</td>
                                <td style="padding: 0.4rem; text-align: right; color: var(--text-muted); font-size: 0.8em; font-family: monospace;">${p.avgElo || '-'}</td>
                            </tr>`;
                        });
                        html += `</tbody></table></div>`;
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">Soupiska není k dispozici.</p>';
                    }
                } catch (e) {
                    console.error('Error loading roster:', e);
                    container.innerHTML = '<p style="color: #fca5a5; text-align: center;">Chyba načítání soupisky.</p>';
                }
            }
        }

        async function loadStandings(competitionId, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Loading state
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    <i class="fa-solid fa-spinner fa-spin"></i> Načítám tabulku...
                </div>
            `;

            try {
                // Determine API URL - in this case we use the main standings endpoint which returns ALL competitions
                // We need to filter for the specific one on the client side since our backend returns a list
                // OR we can rely on the fact that /api/standings (GET) usually serves a JSON file with all data.
                // Wait, server.js exports /api/standings/update (POST). Where is the GET endpoint?
                // Step 1209 summary says youth.html calls /api/standings.
                // I need to check if /api/standings exists as a static file server or GET route.
                // Assuming it serves the 'data/standings.json' file or similar.

                // Let's assume there is an endpoint or file. 
                // Based on youth.html context (Step 225 from previous conv), it fetches './data/standings.json' or '/api/standings'.
                // I will use fetch('/api/standings') if it exists, or check how youth.html does it exactly.

                // Correction: The backend code showed app.post('/api/standings/update').
                // It usually saves to a file. I assumed there is a GET route serving it.
                // If not, I should add it or use the static file if exposed.
                // Let's assume '/data/standings.json' is available if static folder is mapped?
                // Or I can add a GET route in server.js to be safe. 
                // But for now, let's look at youth.html lines 220-302 (viewed in Step 1378).
                // It calls `/api/standings`.

                const res = await fetch(`${API_URL}/standings`);
                if (!res.ok) throw new Error('Failed to load standings');

                const data = await res.json();

                // Compatibility check: server might return { standings: [...] } or just [...]
                const competitions = data.standings || data;

                // Check if competitions is an array
                if (!Array.isArray(competitions)) {
                    throw new Error('Invalid data format');
                }

                const competition = competitions.find(c => c.competitionId === competitionId);

                if (!competition || !competition.standings || competition.standings.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 1rem; color: var(--text-muted); font-style: italic;">
                            Tabulka zatím není k dispozici.
                        </div>
                    `;
                    return;
                }

                // Render Table with improved UI
                const compName = competition.name || 'Tabulka';
                let html = `
                    <div style="background: linear-gradient(135deg, rgba(30,30,40,0.9) 0%, rgba(20,20,30,0.95) 100%); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                        <div style="background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, rgba(212,175,55,0.05) 100%); padding: 0.75rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <h4 style="margin: 0; color: var(--primary-color); font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fa-solid fa-trophy"></i> ${compName}
                            </h4>
                        </div>
                        <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
                            <thead>
                                <tr style="background: rgba(0,0,0,0.3);">
                                    <th style="text-align: center; padding: 0.4rem 0.25rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;">#</th>
                                    <th style="text-align: left; padding: 0.4rem 0.25rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase;">Družstvo</th>
                                    <th style="text-align: center; padding: 0.4rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;" title="Výhry-Remízy-Prohry">V/R/P</th>
                                    <th style="text-align: right; padding: 0.4rem 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.65rem; text-transform: uppercase; white-space: nowrap;" title="Zápasové body">Body</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                competition.standings.forEach((s, idx) => {
                    const isBizuterie = s.isBizuterie || s.team.toLowerCase().includes('bižuterie');
                    const bgColor = idx % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'rgba(0,0,0,0.15)';

                    // Position badge styling (compact)
                    let positionBadge = '';
                    if (s.rank === 1) {
                        positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #ffd700, #b8860b); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #000;">1</span>';
                    } else if (s.rank === 2) {
                        positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #c0c0c0, #808080); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #000;">2</span>';
                    } else if (s.rank === 3) {
                        positionBadge = '<span style="display: inline-flex; align-items: center; justify-content: center; width: 1.1rem; height: 1.1rem; background: linear-gradient(135deg, #cd7f32, #8b4513); border-radius: 50%; font-size: 0.55rem; font-weight: 700; color: #fff;">3</span>';
                    } else {
                        positionBadge = `<span style="color: var(--text-muted); font-size: 0.7rem;">${s.rank}</span>`;
                    }

                    // Bižuterie highlight
                    const rowStyle = isBizuterie
                        ? `background: linear-gradient(90deg, rgba(212,175,55,0.15) 0%, ${bgColor} 100%); border-left: 3px solid var(--primary-color);`
                        : `background: ${bgColor};`;
                    const teamStyle = isBizuterie ? 'font-weight: 600; color: var(--primary-color);' : '';

                    // W/D/L display
                    const wdl = (s.wins !== undefined) ? `<span style="color:#4ade80">${s.wins}</span>/<span style="color:#fbbf24">${s.draws || 0}</span>/<span style="color:#f87171">${s.losses || 0}</span>` : '-';

                    // Determine team anchor and roster ID for Bižuterie teams
                    let teamClickHandler = '';
                    if (isBizuterie) {
                        // Map team name to anchor ID and roster ID
                        const teamLower = s.team.toLowerCase();
                        let anchorId = '', rosterId = '', rosterUrl = '', rosterSnr = '';
                        if (teamLower.includes('"a"') || /\\ba\\b/.test(teamLower) || teamLower.endsWith(' a')) {
                            anchorId = 'team-kp-A'; rosterId = 'roster-kp-A'; rosterUrl = 'https://chess-results.com/tnr1276470.aspx?lan=5'; rosterSnr = '1';
                        } else if (teamLower.includes('"b"') || /\\bb\\b/.test(teamLower) || teamLower.endsWith(' b')) {
                            anchorId = 'team-kp-B'; rosterId = 'roster-kp-B'; rosterUrl = 'https://chess-results.com/tnr1276470.aspx?lan=5'; rosterSnr = '10';
                        } else if (teamLower.includes('"c"') || /\\bc\\b/.test(teamLower) || teamLower.endsWith(' c')) {
                            anchorId = 'team-ks-C'; rosterId = 'roster-ks-C'; rosterUrl = 'https://chess-results.com/tnr1278502.aspx?lan=5'; rosterSnr = '4';
                        } else if (teamLower.includes('"d"') || /\\bd\\b/.test(teamLower) || teamLower.endsWith(' d')) {
                            anchorId = 'team-ks-D'; rosterId = 'roster-ks-D'; rosterUrl = 'https://chess-results.com/tnr1278502.aspx?lan=5'; rosterSnr = '5';
                        }
                        if (anchorId) {
                            teamClickHandler = `onclick="navigateToTeam('${anchorId}', '${rosterId}', '${rosterUrl}', ${rosterSnr})" style="cursor: pointer; text-decoration: underline; text-decoration-style: dotted;"`;
                        }
                    }

                    html += `
                        <tr style="${rowStyle} transition: background 0.2s;" onmouseover="this.style.background='rgba(212,175,55,0.1)'" onmouseout="this.style.background='${isBizuterie ? 'linear-gradient(90deg, rgba(212,175,55,0.15) 0%, ' + bgColor + ' 100%)' : bgColor}'">
                            <td style="padding: 0.35rem 0.2rem; text-align: center;">${positionBadge}</td>
                            <td style="padding: 0.35rem 0.2rem; ${teamStyle} font-size: 0.78rem;" ${teamClickHandler}>${s.team}</td>
                            <td style="padding: 0.35rem 0.5rem; text-align: center; font-family: monospace; font-size: 0.72rem; white-space: nowrap;">${wdl}</td>
                            <td style="padding: 0.35rem 0.5rem; text-align: right; font-weight: 700; font-family: monospace; font-size: 0.85rem;">${s.points !== null ? s.points : '-'}</td>
                        </tr>
                    `;
                });

                const sourceName = (competition.url && competition.url.includes('chess-results')) ? 'Chess-Results.com' : 'ŠSČR';
                const sourceUrl = competition.url || competition.chessczUrl || '#';

                html += `
                            </tbody>
                        </table>
                        </div>
                        <div style="padding: 0.75rem 1rem; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: flex-end;">
                            <a href="${sourceUrl}" target="_blank" style="color: var(--text-muted); text-decoration: none; font-size: 0.75rem; display: flex; align-items: center; gap: 0.3rem; transition: color 0.2s;" onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='var(--text-muted)'">
                                <i class="fa-solid fa-external-link-alt"></i> ${sourceName}
                            </a>
                        </div>
                    </div>
                `;

                container.innerHTML = html;

            } catch (e) {
                console.error(e);
                container.innerHTML = `
                    <div style="text-align: center; padding: 1rem; color: #fca5a5;">
                        Chyba při načítání dat.
                    </div>
                `;
            }
        }

        window.openScheduleModal = function (scheduleData, teamName) {
            const schedule = (typeof scheduleData === 'string') ? JSON.parse(decodeURIComponent(scheduleData)) : scheduleData;
            const modalBody = document.getElementById('modalBody');
            document.getElementById('modalTeamName').textContent = teamName;

            let html = `
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th>Kolo</th>
                            <th>Datum</th>
                            <th>Soupeř</th>
                            <th style="text-align:right;">Výsledek</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            schedule.forEach(m => {
                html += `
                    <tr>
                        <td>${m.round}.</td>
                        <td>${m.date}</td>
                        <td>${m.opponent}</td>
                        <td style="text-align:right; font-weight:bold;">${m.result}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            modalBody.innerHTML = html;
            document.getElementById('scheduleModal').style.display = 'block';
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('scheduleModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

</html>