<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Spr√°va webu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        :root {
            --editor-bg: #1e1e1e;
            --editor-border: rgba(255, 255, 255, 0.1);
        }

        .admin-container {
            max-width: 1800px;
            width: 100%;
            box-sizing: border-box;
            margin: 100px auto 2rem;
            padding: 0 2rem;
            overflow-x: hidden;
        }

        .login-container {
            max-width: 400px;
            margin: 150px auto;
            padding: 2rem;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--editor-border);
        }

        .admin-header {
            background: linear-gradient(135deg, #1f2937, #111827);
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        /* Explicit Header Navigation Styles */
        #adminPanel header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #0f172a;
            /* Dark sleek background */
            z-index: 10000;
            padding: 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        #adminPanel nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1800px;
            margin: 0 auto;
            padding: 0.75rem 2rem;
        }

        #adminPanel .nav-links {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        #adminPanel .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        #adminPanel .nav-links a {
            color: #e2e8f0;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
            font-size: 0.95rem;
        }

        #adminPanel .nav-links a:hover {
            color: var(--primary-color);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--editor-border);
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            color: var(--primary-color);
            font-weight: 600;
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-published {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
        }

        .status-draft {
            background: rgba(234, 179, 8, 0.2);
            color: #fde047;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            margin-right: 0.25rem;
            transition: all 0.2s;
        }

        .btn-edit {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .btn-delete {
            background: rgba(220, 38, 38, 0.2);
            color: #fca5a5;
        }

        .btn-publish {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
        }

        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            min-height: 80vh;
        }

        .editor-main,
        .editor-sidebar {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--editor-border);
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--editor-border);
            border-radius: 6px;
            color: var(--text-color);
            font-family: inherit;
        }

        .wysiwyg-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--editor-border);
            border-radius: 6px 6px 0 0;
            border-bottom: none;
        }

        .wysiwyg-toolbar button {
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: 1px solid transparent;
            color: var(--text-color);
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .wysiwyg-toolbar button:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--primary-color);
        }

        .wysiwyg-toolbar button.active {
            background: rgba(212, 175, 55, 0.4);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .wysiwyg-toolbar .divider {
            width: 1px;
            background: var(--editor-border);
            margin: 0 0.5rem;
        }

        .editor-main {
            min-width: 0;
            /* Prevents grid blowout */
        }

        .wysiwyg-content {
            min-height: 400px;
            padding: 1rem;
            background: var(--editor-bg);
            border: 1px solid var(--editor-border);
            border-radius: 0 0 6px 6px;
            color: var(--text-color);
            line-height: 1.6;
            outline: none;
            overflow-y: auto;
            max-width: 100%;
            box-sizing: border-box;
            overflow-wrap: anywhere;
            word-break: break-word;
            word-wrap: break-word;
            /* Fallback */
        }

        .wysiwyg-content:focus {
            border-color: var(--primary-color);
        }

        .highlight-name {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(147, 51, 234, 0.3));
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .highlight-score {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(16, 185, 129, 0.3));
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-weight: 700;
        }

        .wysiwyg-content a {
            color: #60a5fa;
            text-decoration: underline;
            text-underline-offset: 2px;
            cursor: pointer;
        }

        .wysiwyg-content a::after {
            content: ' üîó';
            font-size: 0.7em;
        }

        .wysiwyg-content a:hover {
            color: #93c5fd;
        }

        .preview-card {
            margin-bottom: 1.5rem;
        }

        .preview-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
        }

        .news-preview {
            background: var(--editor-bg);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--editor-border);
        }

        .preview-image {
            height: 180px;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .preview-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-upload {
            border: 2px dashed var(--editor-border);
            border-radius: 6px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: var(--primary-color);
            background: rgba(212, 175, 55, 0.05);
        }

        .image-upload.has-image {
            padding: 0;
            border: none;
        }

        .uploaded-thumb {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
        }

        /* Styles for content blocks in editor */
        .wysiwyg-content .puzzle-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .wysiwyg-content .puzzle-section img {
            max-width: 320px;
            margin: 1rem auto;
            display: block;
        }

        .wysiwyg-content .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .wysiwyg-content .card-content {
            padding: 1.5rem;
        }

        #articlePreview .puzzle-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        #articlePreview .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 1rem 0;
        }

        #articlePreview .card-content {
            padding: 1.5rem;
        }

        .panel-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            border: 1px solid var(--editor-border);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .game-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            cursor: grab;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .game-item .game-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .game-item .game-body {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .game-item .game-body .game-title-input {
            flex: 1;
            min-width: 120px;
        }

        .game-item .game-body>div {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .game-item .game-actions {
            flex-shrink: 0;
            margin-left: auto;
        }

        .game-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .game-item.dragging {
            opacity: 0.5;
            background: rgba(212, 175, 55, 0.2);
            border: 1px dashed var(--primary-color);
        }

        .game-item.drag-over {
            border-top: 2px solid var(--primary-color);
        }

        .game-item .drag-handle {
            cursor: grab;
            color: var(--text-muted);
            margin-right: 0.75rem;
        }

        .game-item .game-inputs {
            display: flex;
            gap: 0.5rem;
            flex: 1;
        }

        .game-item .game-title-input {
            flex: 2;
            padding: 0.3rem 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--editor-border);
            border-radius: 4px;
            color: var(--text-color);
            font-size: 0.85rem;
        }

        .game-item .game-id-input {
            flex: 1;
            padding: 0.3rem 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--editor-border);
            border-radius: 4px;
            color: var(--text-color);
            font-size: 0.85rem;
            max-width: 120px;
        }

        .game-item .game-actions {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-left: 0.5rem;
        }

        .game-item .team-badge {
            font-size: 0.75rem;
            padding: 0.15rem 0.5rem;
            border-radius: 3px;
            margin-left: 0.5rem;
        }

        .team-checkbox-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .team-checkbox {
            display: flex;
            align-items: center;
            padding: 0.4rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .team-checkbox:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .team-checkbox input {
            margin-right: 0.5rem;
        }

        .team-checkbox.checked {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid var(--primary-color);
        }

        .add-team-input {
            display: flex;
            gap: 0.5rem;
        }

        .add-team-input input {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.85rem;
        }

        .add-team-input button {
            padding: 0.5rem 0.75rem;
        }

        .admin-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--editor-border);
            padding-bottom: 1rem;
        }

        .nav-tab {
            padding: 0.6rem 1.2rem;
            cursor: pointer;
            border-radius: 6px;
            color: var(--text-muted);
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: var(--secondary-color);
            font-weight: 600;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--secondary-color);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-color);
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--editor-border);
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        .hidden {
            display: none !important;
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-error {
            background: rgba(220, 38, 38, 0.1);
            color: #fca5a5;
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.1);
            color: #86efac;
        }

        /* Tablet and smaller desktop */
        @media (max-width: 1200px) {
            .editor-layout {
                grid-template-columns: 1fr;
            }

            .editor-sidebar {
                order: 1;
                /* Put sidebar AFTER content on mobile */
                margin-top: 1rem;
            }
        }

        /* Tablet */
        @media (max-width: 992px) {
            .admin-container {
                padding: 1rem;
            }

            .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                padding: 1rem;
            }

            .admin-header h1 {
                font-size: 1.25rem !important;
            }

            .admin-nav {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                gap: 0.25rem;
                padding-bottom: 0.5rem;
            }

            .admin-nav::-webkit-scrollbar {
                display: none;
            }

            .nav-tab {
                white-space: nowrap;
                flex-shrink: 0;
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .nav-tab i {
                display: none;
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            header nav {
                flex-direction: column;
                gap: 0.5rem;
            }

            header .nav-links {
                gap: 1rem;
                flex-direction: row;
                justify-content: center;
                flex-wrap: wrap;
            }

            .admin-header {
                padding: 0.75rem;
                border-radius: 8px;
                margin-bottom: 1rem;
            }

            .admin-header h1 {
                font-size: 1rem !important;
            }

            .admin-header p {
                font-size: 0.75rem !important;
            }

            header .nav-links a {
                padding: 0.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 4px;
            }

            .nav-tab {
                padding: 0.4rem 0.6rem;
                font-size: 0.7rem;
            }

            .form-group label {
                font-size: 0.8rem;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 0.85rem;
                padding: 0.5rem;
            }

            .btn-primary,
            .btn-secondary {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }

            .data-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .data-table th,
            .data-table td {
                padding: 0.4rem 0.3rem;
                font-size: 0.7rem;
            }

            /* Title column can wrap */
            .data-table td:nth-child(2) {
                white-space: normal;
                word-break: break-word;
                max-width: 150px;
            }

            /* Other columns stay compact */
            .data-table td:nth-child(1),
            .data-table td:nth-child(5),
            .data-table td:nth-child(6) {
                white-space: nowrap;
            }

            .wysiwyg-toolbar {
                gap: 0.25rem;
                padding: 0.5rem;
            }

            .wysiwyg-toolbar button {
                padding: 0.4rem 0.5rem;
                font-size: 0.7rem;
            }

            .wysiwyg-content {
                min-height: 200px;
                font-size: 0.9rem;
            }

            .preview-card {
                margin-bottom: 0.75rem;
            }

            .panel-section {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
            }

            .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }

        /* Small mobile */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .admin-container {
                padding: 0.5rem;
            }

            .admin-header h1 {
                font-size: 0.9rem !important;
            }

            .nav-tab {
                padding: 0.35rem 0.5rem;
                font-size: 0.65rem;
            }

            .editor-sidebar {
                padding: 0.75rem;
            }

            .status-text {
                display: none;
            }

            .hide-mobile {
                display: none !important;
            }
        }

        /* Toast Notifications */
        #alertContainer {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 99999;
            width: auto;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        #alertContainer .alert {
            pointer-events: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            margin: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary-color);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        /* Image Modal Styles */
        #imageModal {
            display: none;
        }

        #imageModal .modal-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: rgba(0, 0, 0, 0.85) !important;
            z-index: 9998 !important;
        }

        #imageModal .modal-content {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 9999 !important;
            background: #1a1a2e !important;
            border-radius: 12px !important;
            padding: 1.5rem !important;
            max-width: 500px !important;
            width: 90% !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6) !important;
        }

        /* Responsive Styles */
        @media (max-width: 1024px) {
            .editor-layout {
                grid-template-columns: 1fr;
            }

            .editor-sidebar {
                /* Removing order: -1 so it flows below main content */
                margin-bottom: 2rem;
            }
        }

        @media (max-width: 768px) {
            .admin-container {
                margin-top: 80px;
                padding: 0 1rem;
            }

            .admin-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
                padding: 1rem;
            }

            #adminPanel nav {
                padding: 0.5rem 1rem;
            }

            #adminPanel .logo {
                font-size: 1rem;
            }

            #adminPanel .nav-links {
                gap: 1rem;
            }

            #adminPanel .nav-links a span {
                display: none;
                /* Hide text on very small screens if needed, or keep */
            }

            /* Ensure tabular data doesn't break layout */
            .data-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .admin-nav {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .nav-tab {
                white-space: nowrap;
                flex: 1 1 auto;
                /* Allow tabs to grow/shrink but respect content */
                text-align: center;
                min-width: fit-content;
            }

            /* Ensure tabular data doesn't break layout */
            .data-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .admin-nav {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .nav-tab {
                white-space: nowrap;
                flex: 1 1 auto;
                /* Allow tabs to grow/shrink but respect content */
                text-align: center;
                min-width: fit-content;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Puzzle Racer Admin Styles */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .settings-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--editor-border);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .settings-card h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .settings-card .form-group:last-child {
            margin-bottom: 0;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .control-row label {
            margin-bottom: 0;
        }
    </style>
</head>

<body>
    <!-- LOGIN -->
    <div id="loginPage" class="hidden">
        <div class="login-container">
            <h1 style="text-align: center; margin-bottom: 2rem;"><i class="fa-solid fa-chess-knight"
                    style="color: var(--primary-color);"></i><br>Admin Panel v2025.12.14</h1>
            <div id="loginError"></div>
            <form id="loginForm">
                <div class="form-group"><label>U≈æivatelsk√© jm√©no</label><input type="text" id="username" required>
                </div>
                <div class="form-group"><label>Heslo</label>
                    <div style="position: relative;"><input type="password" id="password" required
                            style="padding-right: 40px;"><i class="fa-solid fa-eye" id="togglePassword"
                            style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-muted);"></i>
                    </div>
                </div><button type="submit" class="btn-primary" style="width: 100%">P≈ôihl√°sit se</button>
            </form>
        </div>
    </div>
    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="hidden">
        <header>
            <div class="container">
                <nav><a href="/" class="logo"><i class="fa-solid fa-chess-knight"></i>TJ Bi≈æuterie -
                        Admin</a>
                    <ul class="nav-links">
                        <li style="display: flex; align-items: center; margin-right: 1rem;"><label class="switch"
                                style="margin-bottom: 0;"><input type="checkbox" id="maintenanceToggle"
                                    onchange="toggleMaintenance()"><span class="slider round"></span></label><span
                                style="font-size: 0.8rem; margin-left: 0.5rem; color: #aaa;">√ödr≈æba</span></li>
                        <li><a href="/" target="_blank"><i class="fa-solid fa-home"></i>Web</a></li>
                        <li><a href="#" onclick="logout()" style="color: #fca5a5;"><i
                                    class="fa-solid fa-sign-out-alt"></i>Odhl√°sit</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <div class="admin-container">
            <div class="admin-header">
                <div>
                    <h1><i class="fa-solid fa-cogs"></i>Spr√°va webu</h1>
                    <p style="margin: 0.25rem 0 0 0; font-size: 0.9rem; opacity: 0.8; visibility: visible !important;"
                        id="userInfo"></p>
                    <p style="margin: 0.1rem 0 0 0; font-size: 0.7rem; opacity: 0.5; font-family: monospace;">
                        Build: 2025-12-12 14:27 #v8</p>
                </div>
            </div>
            <div class="admin-nav">
                <div class="nav-tab active" onclick="switchTab('dashboard')"><i class="fa-solid fa-list"></i>P≈ôehled
                </div>
                <div class="nav-tab" onclick="switchTab('editor'); resetEditor();"><i class="fa-solid fa-plus"></i>Nov√°
                    novinka</div>
                <div class="nav-tab" onclick="switchTab('members')" style="display: none;"><i
                        class="fa-solid fa-address-book"></i>ƒålenov√© </div>
                <div class="nav-tab" onclick="switchTab('users')" id="usersTab" style="display: none;"><i
                        class="fa-solid fa-users"></i>U≈æivatel√©</div>
                <div class="nav-tab" onclick="switchTab('competitions')" id="competitionsTab" style="display: none;"><i
                        class="fa-solid fa-trophy"></i>Soutƒõ≈æe</div>
                <div class="nav-tab" onclick="switchTab('gallery')" id="galleryTab" style="display: none;"><i
                        class="fa-regular fa-images"></i>Galerie</div>
                <div class="nav-tab" onclick="switchTab('blicak')" id="blicakTab"><i class="fa-solid fa-bolt"></i>Blic√°k
                </div>
                <div class="nav-tab" id="puzzleRacerTab" onclick="switchTab('puzzleRacer')"><i
                        class="fa-solid fa-puzzle-piece"></i>Puzzle Racer</div>
            </div>
            <div id="alertContainer"></div>
            <!-- DASHBOARD -->
            <div id="dashboardView">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="margin: 0;">Seznam novinek</h2><button class="btn-primary"
                        onclick="switchTab('editor'); resetEditor();"><i class="fa-solid fa-plus"></i>Nov√°
                        novinka</button>
                </div>
                <table class="data-table" id="newsTable">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>N√°zev</th>
                            <th class="hide-mobile">Kategorie</th>
                            <th class="hide-mobile">Autor</th>
                            <th class="hide-mobile">Stav</th>
                            <th>Akce</th>
                        </tr>
                    </thead>
                    <tbody id="newsTableBody"></tbody>
                </table>
            </div>
            <!-- EDITOR -->
            <div id="editorView" class="hidden">
                <div class="editor-layout">
                    <!-- Main Editor (70%) -->
                    <div class="editor-main">
                        <h2 style="margin-top: 0;" id="editorTitle">Nov√° novinka</h2><input type="hidden"
                            id="editNewsId">
                        <div class="form-group"><label>Nadpis ƒçl√°nku *</label><input type="text" id="newsTitle"
                                placeholder="Zadejte nadpis..." oninput="updatePreview()">
                        </div>
                        <!-- WYSIWYG Editor -->
                        <div class="form-group"><label>Obsah ƒçl√°nku *</label>
                            <div class="wysiwyg-toolbar" style="flex-wrap: wrap;">
                                <!-- Row 1: Formatting --><button type="button" id="btnBold"
                                    onclick="formatText('bold')" title="Tuƒçnƒõ (Ctrl+B)"><i
                                        class="fa-solid fa-bold"></i></button><button type="button" id="btnItalic"
                                    onclick="formatText('italic')" title="Kurz√≠va (Ctrl+I)"><i
                                        class="fa-solid fa-italic"></i></button><button type="button" id="btnUnderline"
                                    onclick="formatText('underline')" title="Podtr≈æen√≠ (Ctrl+U)"><i
                                        class="fa-solid fa-underline"></i></button>
                                <div class="divider"></div>
                                <!-- Heading buttons -->
                                <div
                                    style="display: flex; gap: 2px; background: rgba(255,255,255,0.05); border-radius: 4px; padding: 2px;">
                                    <button type="button" id="headingP" onclick="applyHeading('p')"
                                        title="Norm√°ln√≠ text"
                                        style="padding: 0.25rem 0.5rem; font-size: 0.7rem; font-weight: 600; border-radius: 3px; min-width: 28px;">P</button><button
                                        type="button" id="headingH1" onclick="applyHeading('h1')" title="Nadpis 1"
                                        style="padding: 0.25rem 0.5rem; font-size: 0.7rem; font-weight: 700; border-radius: 3px; min-width: 28px;">H1</button><button
                                        type="button" id="headingH2" onclick="applyHeading('h2')" title="Nadpis 2"
                                        style="padding: 0.25rem 0.5rem; font-size: 0.7rem; font-weight: 600; border-radius: 3px; min-width: 28px;">H2</button><button
                                        type="button" id="headingH3" onclick="applyHeading('h3')" title="Nadpis 3"
                                        style="padding: 0.25rem 0.5rem; font-size: 0.7rem; font-weight: 500; border-radius: 3px; min-width: 28px;">H3</button>
                                </div>
                                <div class="divider"></div><button type="button" onclick="insertLink()" title="Odkaz"><i
                                        class="fa-solid fa-link"></i></button><button type="button"
                                    onclick="toggleSource()" title="HTML" id="btnSource"><i
                                        class="fa-solid fa-code"></i></button>
                                <!-- Row 2: Highlights and blocks (will wrap on smaller
                                                            screens) -->
                                <div class="divider" style="height: 0; width: 100%; margin: 0.25rem 0;">
                                </div><button type="button" id="btnHighlightName" onmousedown="event.preventDefault()"
                                    onclick="insertHighlight('name')" title="Zv√Ωraznit jm√©no" style="color: #60a5fa;"><i
                                        class="fa-solid fa-user"></i>Jm√©no</button><button type="button"
                                    id="btnHighlightScore" onmousedown="event.preventDefault()"
                                    onclick="insertHighlight('score')" title="Zv√Ωraznit sk√≥re"
                                    style="color: #4ade80;"><i class="fa-solid fa-trophy"></i>Sk√≥re</button>
                                <div class="divider"></div><button type="button" onclick="insertIntroBlock()"
                                    title="Puzzle blok" style="color: #fbbf24;"><i
                                        class="fa-solid fa-lightbulb"></i></button><button type="button"
                                    onclick="insertImage()" title="Obr√°zek" style="color: #f472b6;"><i
                                        class="fa-solid fa-image"></i></button><button type="button"
                                    onclick="insertCollapsibleBlock()" title="Rozbalovac√≠ sekce"
                                    style="color: #8b5cf6;"><i class="fa-solid fa-layer-group"></i></button>
                            </div>
                            <div class="wysiwyg-content" id="articleContent" contenteditable="true"
                                oninput="updatePreview()"></div><textarea id="articleSource"
                                class="wysiwyg-content hidden" oninput="updateContentFromSource()"></textarea>
                        </div>
                        <!-- Games Panel -->
                        <div class="panel-section">
                            <div class="panel-header"><label style="margin: 0;"><i
                                        class="fa-solid fa-chess-board"></i>P≈ôehr√°vaƒç
                                    parti√≠</label></div>
                            <div class="form-group" id="gamesInputPanel">
                                <div
                                    style="background: rgba(255, 255, 255, 0.05); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem;">
                                    <h4
                                        style="margin-top: 0; margin-bottom: 0.5rem; color: var(--primary-color); font-size: 0.85rem;">
                                        P≈ôidat partii</h4>
                                    <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                                        <input type="text" id="gameTitle" placeholder="Kdo s k√Ωm"
                                            style="flex: 1; min-width: 120px; max-width: 180px; font-size: 0.8rem; padding: 0.4rem;"><input
                                            type="text" id="gameId" placeholder="Chess.com ID"
                                            style="width: 120px; font-size: 0.8rem; padding: 0.4rem;"><label
                                            style="display: flex; align-items: center; gap: 0.3rem; cursor: pointer; font-size: 0.75rem; white-space: nowrap;"><input
                                                type="checkbox" id="gameCommented"
                                                style="width: auto; margin: 0;">Koment.
                                        </label><button type="button" class="btn-primary btn-small" onclick="addGame()"
                                            style="padding: 0.4rem 0.6rem; font-size: 0.75rem; white-space: nowrap;"><i
                                                class="fa-solid fa-plus"></i>P≈ôidat
                                        </button>
                                    </div>
                                </div>
                                <div
                                    style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                    <h4 style="margin-top: 0; color: var(--primary-color);">
                                        P≈ôidat nadpis (oddƒõlovaƒç) </h4>
                                    <div style="display: flex; gap: 0.5rem;"><input type="text" id="headerTitle"
                                            placeholder="Nap≈ô. A t√Ωm, B t√Ωm..."><button type="button"
                                            class="btn-secondary btn-small" onclick="addHeader()"><i
                                                class="fa-solid fa-heading"></i>P≈ôidat
                                        </button></div>
                                </div>
                            </div>
                            <div id="gamesList" style="margin-top: 1rem;"></div>
                        </div>
                        <!-- Gallery Panel -->
                        <div class="panel-section">
                            <div class="panel-header"><label style="margin: 0;"><i
                                        class="fa-solid fa-images"></i>Galerie</label>
                                <div style="display: flex; gap: 0.5rem;"><button type="button"
                                        class="btn-secondary btn-small"
                                        onclick="document.getElementById('galleryInput').click()"><i
                                            class="fa-solid fa-upload"></i>Nahr√°t</button><button type="button"
                                        class="btn-secondary btn-small" onclick="toggleGalleryUrlInput()"><i
                                            class="fa-solid fa-link"></i>URL</button><button type="button"
                                        class="btn-secondary btn-small" onclick="selectGalleryForArticleGallery()"
                                        title="Vybrat z existuj√≠c√≠ galerie"><i
                                            class="fa-regular fa-images"></i></button>
                                </div><input type="file" id="galleryInput" accept="image/*" multiple
                                    style="display: none;" onchange="addGalleryImages(event)">
                            </div>
                            <div id="galleryUrlInput" class="hidden" style="margin-bottom: 0.75rem;">
                                <div style="display: flex; gap: 0.5rem;"><input type="text" id="galleryImageUrl"
                                        placeholder="URL obr√°zku (https://...)"
                                        style="flex: 1; font-size: 0.85rem;"><button type="button"
                                        class="btn-primary btn-small" onclick="addGalleryFromUrl()">P≈ôidat</button>
                                </div>
                            </div>
                            <div id="galleryPreview" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            </div>
                        </div>
                        <div style="margin-top: 2rem; display: flex; gap: 1rem;"><button class="btn-primary"
                                onclick="saveNews()"><i class="fa-solid fa-save"></i>Ulo≈æit</button><button
                                class="btn-secondary" onclick="switchTab('dashboard')">Zru≈°it</button></div>
                    </div>
                    <!-- Sidebar (30%) -->
                    <div class="editor-sidebar">
                        <!-- SECTION 1: Publikace (collapsible) -->
                        <div id="publikaceSection"
                            style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div onclick="toggleSidebarSection('publikace')"
                                style="display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; margin-bottom: 0.75rem; color: var(--primary-color); cursor: pointer;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fa-solid fa-paper-plane"></i><span
                                        style="font-weight: 600;">Publikace</span>
                                </div><i class="fa-solid fa-chevron-down" id="publikaceIcon"
                                    style="font-size: 0.7rem; transition: transform 0.2s;"></i>
                            </div>
                            <div id="publikaceContent">
                                <div class="form-group" style="margin-bottom: 0.75rem;">
                                    <label style="font-size: 0.8rem;">Kategorie</label><select id="newsCategory"
                                        onchange="updatePreview()" style="font-size: 0.85rem;">
                                        <option value="Soutƒõ≈æe dru≈æstev">Soutƒõ≈æe dru≈æstev
                                        </option>
                                        <option value="Odd√≠lov√Ω p≈ôebor">Odd√≠lov√Ω p≈ôebor
                                        </option>
                                        <option value="Ml√°de≈æ">Ml√°de≈æ</option>
                                        <option value="O n√°s">O n√°s</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 0.75rem;">
                                    <label style="font-size: 0.8rem;">Datum</label><input type="date" id="newsDate"
                                        oninput="updatePreview()" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group" style="margin-bottom: 0.75rem;">
                                    <label style="font-size: 0.8rem;">Kr√°tk√Ω
                                        popis</label><textarea id="newsExcerpt" rows="2"
                                        placeholder="Zobraz√≠ se na kartƒõ..." oninput="updatePreview()"
                                        style="font-size: 0.85rem;"></textarea>
                                </div><label
                                    style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;"><input
                                        type="checkbox" id="publishCheck" style="width: auto;"><span>Publikovat
                                        ihned</span></label><button type="button" class="btn-primary"
                                    onclick="saveNews()"
                                    style="width: 100%; margin-top: 1rem; justify-content: center;"><i
                                        class="fa-solid fa-save"></i>Ulo≈æit </button>
                            </div>
                            <!-- end publikaceContent -->
                        </div>
                        <!-- end publikaceSection -->
                        <!-- SECTION 2: Obr√°zek -->
                        <div
                            style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div
                                style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; color: #f472b6;">
                                <i class="fa-solid fa-image"></i><span style="font-weight: 600;">N√°hledov√Ω
                                    obr√°zek</span>
                            </div>
                            <div class="image-upload" id="uploadArea"
                                onclick="document.getElementById('imageInput').click()"
                                style="height: 120px; margin-bottom: 0.5rem; position: relative;">
                                <div id="uploadPlaceholder"><i class="fa-solid fa-cloud-upload-alt"
                                        style="font-size: 1.2rem; color: var(--primary-color);"></i>
                                    <p style="margin: 0.3rem 0 0 0; font-size: 0.75rem;">
                                        Kliknƒõte pro nahr√°n√≠ </p>
                                </div><img id="uploadedImage" class="uploaded-thumb" style="display: none;"><button
                                    type="button" id="removeImageBtn" onclick="event.stopPropagation(); removeImage();"
                                    style="display: none; position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); border: none; color: #f87171; padding: 0.3rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.7rem;"><i
                                        class="fa-solid fa-times"></i></button>
                            </div><input type="file" id="imageInput" accept="image/*" style="display: none;"
                                onchange="handleImageUpload(event)">
                            <div id="imageUrlWrapper" style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="text" id="imageUrl" placeholder="nebo URL obr√°zku"
                                    style="font-size: 0.8rem; flex: 1;"><button type="button"
                                    class="btn-secondary btn-small" onclick="handleImageUrl()"
                                    style="padding: 0.4rem 0.6rem; font-size: 0.75rem;">Pou≈æ√≠t</button><button
                                    type="button" class="btn-secondary btn-small" onclick="selectGalleryForThumbnail()"
                                    style="padding: 0.4rem 0.6rem; font-size: 0.75rem;" title="Vybrat z galerie"><i
                                        class="fa-regular fa-images"></i></button>
                            </div>
                            <!-- Crop position selector -->
                            <div id="cropPositionWrapper" style="display: none; margin-top: 0.8rem;">
                                <label
                                    style="font-size: 0.75rem; color: var(--text-muted); display: flex; justify-content: space-between; margin-bottom: 0.4rem;"><span>Pozice
                                        o≈ôezu (v√Ω≈°ka):</span><span id="cropValueLabel"
                                        style="color: var(--primary-color);">50%</span></label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 0.7rem; color: var(--text-muted);">Horn√≠</span><input
                                        type="range" id="cropSlider" min="0" max="100" value="50" step="1"
                                        oninput="updateCropFromSlider(this.value)"
                                        style="flex: 1; cursor: pointer;"><span
                                        style="font-size: 0.7rem; color: var(--text-muted);">Doln√≠</span>
                                </div>
                            </div><button type="button" onclick="rotateImage()"
                                style="width: 100%; margin-top: 0.5rem; padding: 0.3rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--editor-border); color: var(--text-color); border-radius: 4px; cursor: pointer; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;"><i
                                    class="fa-solid fa-rotate-right"></i>Otoƒçit
                                o 90¬∞ </button>
                        </div>
                        <!-- SECTION 3: N√°hledy -->
                        <div>
                            <div
                                style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; color: #60a5fa;">
                                <i class="fa-solid fa-eye"></i><span style="font-weight: 600;">N√°hledy</span>
                            </div>
                            <!-- Card preview -->
                            <div class="preview-card" style="margin-bottom: 0.75rem;">
                                <div class="preview-title" style="font-size: 0.75rem; padding: 0.5rem;">
                                    Karta</div>
                                <div class="news-preview"
                                    style="width: 100%; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; overflow: hidden; background: #1a1a1a;">
                                    <div class="preview-image" id="previewImage"
                                        style="height: 120px; text-align: center; background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                        <i class="fa-solid fa-image"
                                            style="font-size: 1.5rem; color: var(--text-muted);"></i>
                                    </div>
                                    <div class="card-content" style="padding: 0.75rem;"><span class="card-category"
                                            id="previewCategory" style="font-size: 0.6rem;">Kategorie</span><span
                                            class="card-date" id="previewDate" style="font-size: 0.55rem;">Datum</span>
                                        <h3 class="card-title" id="previewTitle"
                                            style="font-size: 0.8rem; margin: 0.3rem 0;">
                                            Nadpis</h3>
                                        <p class="card-excerpt" id="previewExcerpt"
                                            style="font-size: 0.7rem; color: var(--text-muted);">
                                            Popis...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- USERS -->
    <!-- MEMBERS -->
    <div id="membersView" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2 style="margin: 0;">Seznam ƒçlen≈Ø</h2><button class="btn-primary" onclick="openMemberModal()"><i
                    class="fa-solid fa-user-plus"></i>Nov√Ω ƒçlen</button>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Jm√©no</th>
                    <th>ELO</th>
                    <th>Titul</th>
                    <th>Narozen√≠</th>
                    <th>Role</th>
                    <th>Akce</th>
                </tr>
            </thead>
            <tbody id="membersTableBody"></tbody>
        </table>
    </div>
    <div id="usersView" class="hidden">
        <div class="editor-layout">
            <div>
                <h2>Seznam u≈æivatel≈Ø</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Akce</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
            <div class="editor-sidebar">
                <h3>P≈ôidat u≈æivatele</h3>
                <div class="form-group"><label>Username</label><input type="text" id="newUsername">
                </div>
                <div class="form-group"><label>Email</label><input type="email" id="newEmail"></div>
                <div class="form-group"><label>Heslo</label><input type="password" id="newPassword">
                </div>
                <div class="form-group"><label>Role</label><select id="newRole">
                        <option value="admin">Admin</option>
                        <option value="superadmin">Superadmin</option>
                    </select></div><button class="btn-primary" onclick="createUser()">Vytvo≈ôit</button>
            </div>
        </div>
    </div>
    <div id="messagesView" class="hidden">
        <h2><i class="fa-solid fa-comments"></i>Spr√°va vzkazovn√≠ku</h2>
        <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Zde m≈Ø≈æete mazat nevhodn√© p≈ô√≠spƒõvky
            ze vzkazovn√≠ku.</p>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Autor</th>
                    <th>Obsah</th>
                    <th>Datum</th>
                    <th>Akce</th>
                </tr>
            </thead>
            <tbody id="messagesTableBody"></tbody>
        </table>
        <div id="noMessagesInfo" style="text-align: center; padding: 2rem; color: var(--text-muted); display: none;">
            ≈Ω√°dn√©
            vzkazy k zobrazen√≠. </div>
    </div>
    <!-- Blicak Registrations View -->
    <div id="blicakView" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2 style="margin: 0;"><i class="fa-solid fa-bolt"></i>Registrace - V√°noƒçn√≠ blesk</h2>
            <button class="btn-primary" onclick="loadBlicakRegistrations()"><i
                    class="fa-solid fa-sync"></i>Obnovit</button>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Jm√©no</th>
                    <th>Odd√≠l</th>
                    <th>LOK</th>
                    <th>Roƒçn√≠k</th>
                    <th>ƒåas registrace</th>
                </tr>
            </thead>
            <tbody id="blicakTableBody"></tbody>
        </table>
        <div id="noBlicakInfo" style="text-align: center; padding: 2rem; color: var(--text-muted); display: none;">
            ≈Ω√°dn√© registrace. </div>

        <!-- Blic√°k Gallery Management -->
        <div style="margin-top: 3rem; border-top: 1px solid var(--editor-border); padding-top: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0;"><i class="fa-solid fa-camera"></i> Fotografie z turnaje</h3>
                <button class="btn-primary" onclick="document.getElementById('blicakUploadInput').click()">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Nahr√°t fotky
                </button>
                <input type="file" id="blicakUploadInput" multiple accept="image/*" style="display: none;"
                    onchange="handleAdminGalleryUpload(this, 'blicak').then(() => showToast('Fotky nahr√°ny', 'success'))">
            </div>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                Zde nahran√© fotografie se automaticky za≈ôad√≠ do kategorie "blicak" a zobraz√≠ se v galerii na str√°nce
                turnaje.
            </p>
        </div>
    </div>
    <!-- Competitions View -->
    <div id="competitionsView" class="hidden">
        <div class="card"
            style="margin-bottom: 2rem; padding: 1.5rem; background: linear-gradient(135deg, var(--card-bg), rgba(59, 130, 246, 0.1)); border-left: 4px solid #3b82f6;">
            <div
                style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div style="width: 100%;">
                    <h3 style="margin: 0 0 0.5rem 0; color: #3b82f6;"><i class="fa-solid fa-table"></i>Tabulky dru≈æstva
                    </h3>
                    <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">Spr√°va
                        zdroj≈Ø dat pro soutƒõ≈æe. Zmƒõny se projev√≠ po kliknut√≠ na "Aktualizovat
                        tabulky" .</p>
                    <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                        <button class="btn-secondary" onclick="updateStandings()" id="updateStandingsBtn"><i
                                class="fa-solid fa-sync"></i>Aktualizovat
                            tabulky </button>
                    </div>
                    <div id="competitionsList" style="margin-top: 1rem;"></div>
                </div>
            </div>
            <div id="standingsResult" style="margin-top: 1rem; display: none;"></div>
        </div>
    </div>
    <!-- Puzzle Racer Settings View -->
    <div id="puzzleRacerView" class="hidden">
        <div class="card">
            <div
                style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div style="width: 100%;">
                    <h3 style="margin: 0 0 0.5rem 0; color: #3b82f6;"><i class="fa-solid fa-puzzle-piece"></i>Puzzle
                        Racer - Nastaven√≠
                    </h3>
                    <p style="margin: 0; color: var(--text-muted); font-size: 0.9rem;">
                        Konfigurace hern√≠ch parametr≈Ø. Zmƒõny se projev√≠ p≈ôi dal≈°√≠m spu≈°tƒõn√≠
                        hry.</p>
                    <div id="puzzleRacerSettingsForm">
                        <div class="settings-grid">
                            <!-- Helper: General Settings -->
                            <div class="settings-card">
                                <h4><i class="fa-solid fa-sliders"></i>Obecn√© nastaven√≠
                                </h4>
                                <div class="form-group"><label>T√©ma √∫loh</label><select id="prTheme">
                                        <option value="mix">Sm√≠≈°en√© (Doporuƒçeno)
                                        </option>
                                        <option value="opening">Zah√°jen√≠</option>
                                        <option value="middlegame">St≈ôedn√≠ hra</option>
                                        <option value="endgame">Koncovka</option>
                                        <option value="rookEndgame">Vƒõ≈æov√° koncovka
                                        </option>
                                        <option value="bishopEndgame">St≈ôelcov√° koncovka
                                        </option>
                                        <option value="pawnEndgame">Pƒõ≈°cov√° koncovka
                                        </option>
                                        <option value="knightEndgame">Jezdcov√° koncovka
                                        </option>
                                        <option value="queenEndgame">D√°mov√° koncovka
                                        </option>
                                        <optgroup label="Zah√°jen√≠ (nad 10k)">
                                            <option value="sicilianDefense">Sicilsk√° obrana</option>
                                            <option value="queensGambit">D√°msk√Ω gambit</option>
                                            <option value="kingsIndianDefense">Kr√°lovsk√° indick√°</option>
                                            <option value="frenchDefense">Francouzsk√° obrana</option>
                                            <option value="caroKannDefense">Caro-Kann</option>
                                            <option value="ruyLopez">≈†panƒõlsk√° hra</option>
                                            <option value="italianGame">Italsk√° hra</option>
                                            <option value="scandinavianDefense">Skandin√°vsk√° obrana</option>
                                            <option value="englishOpening">Anglick√° hra</option>
                                            <option value="slavDefense">Slovansk√° obrana</option>
                                            <option value="philidorDefense">Philidorova obrana</option>
                                            <option value="nimzoIndianDefense">Nimcoviƒçova indick√°</option>
                                            <option value="queensPawnGame">Hra d√°msk√Ωm pƒõ≈°cem</option>
                                            <option value="kingsGambit">Kr√°lovsk√Ω gambit</option>
                                            <option value="scotchGame">Skotsk√° hra</option>
                                            <option value="modernDefense">Modern√≠ obrana</option>
                                        </optgroup>
                                    </select></div>
                                <div class="form-group"><label>ƒåasov√Ω limit
                                        (sekundy)</label><input type="number" id="prTimeLimit" min="30" max="600"
                                        value="180">
                                </div>
                                <div class="form-group"><label>Puzzl≈Ø na √∫rove≈à
                                        obt√≠≈ænosti</label><input type="number" id="prPuzzlesPerDifficulty" min="1"
                                        max="20" value="6">
                                </div>
                            </div>
                            <!-- Helper: Difficulty & Behavior -->
                            <div class="settings-card">
                                <h4><i class="fa-solid fa-heart-crack"></i>Obt√≠≈ænost a Chyby</h4>

                                <!-- Lives -->
                                <div class="control-row">
                                    <label>Syst√©m ≈æivot≈Ø</label>
                                    <label class="switch">
                                        <input type="checkbox" id="prLivesEnabled" checked>
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div id="prMaxLivesGroup" class="form-group" style="margin-top: 0.5rem;">
                                    <label>Poƒçet ≈æivot≈Ø</label>
                                    <input type="number" id="prMaxLives" min="1" max="10" value="3">
                                </div>

                                <div class="divider"
                                    style="margin: 1rem 0; background: rgba(255,255,255,0.1); height: 1px;"></div>

                                <!-- Randomize -->
                                <div class="control-row">
                                    <label>N√°hodn√© √∫lohy</label>
                                    <label class="switch">
                                        <input type="checkbox" id="prRandomizePuzzles" checked
                                            onchange="togglePrRandomizeUI()">
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <p style="font-size: 0.8rem; color: #888; margin-top: 0.2rem; margin-bottom: 0.5rem;">
                                    Pokud vypnuto, v≈°ichni hr√°ƒçi dostanou stejnou sadu √∫loh.
                                </p>
                                <button id="prRefreshSetBtn" class="btn-secondary" onclick="refreshPrFixedSet()"
                                    style="display: none; width: 100%; font-size: 0.85rem; margin-top: 0.5rem;">
                                    <i class="fa-solid fa-rotate"></i> Vygenerovat novou sadu
                                </button>

                                <div class="divider"
                                    style="margin: 1rem 0; background: rgba(255,255,255,0.1); height: 1px;"></div>

                                <!-- Penalty -->
                                <div class="control-row">
                                    <label>ƒåasov√° penalizace</label>
                                    <label class="switch">
                                        <input type="checkbox" id="prPenaltyEnabled">
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                                <div id="prPenaltySecondsGroup" class="form-group"
                                    style="margin-top: 0.5rem; display: none;">
                                    <label>Sekundy penalizace</label>
                                    <input type="number" id="prPenaltySeconds" min="1" max="60" value="5">
                                </div>

                                <div class="divider"
                                    style="margin: 1rem 0; background: rgba(255,255,255,0.1); height: 1px;"></div>

                                <!-- Skip on Mistake -->
                                <div class="control-row">
                                    <label>P≈ôeskoƒçit po chybƒõ</label>
                                    <label class="switch">
                                        <input type="checkbox" id="prSkipOnMistake">
                                        <span class="slider round"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: flex-end; margin-top: 1.5rem;">
                        <button class="btn-primary" onclick="savePuzzleRacerSettings()" id="savePrSettingsBtn"><i
                                class="fa-solid fa-save"></i>Ulo≈æit
                            nastaven√≠ </button>
                    </div>
                    <div id="prSettingsResult" style="margin-top: 1rem; text-align: center;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!-- Gallery View -->
    <div id="galleryView" class="hidden">
        <div class="header-actions">
            <h2><i class="fa-regular fa-images"></i>Spr√°va Galerie</h2>
            <div style="display: flex; gap: 1rem;"><button id="batchDeleteBtn" class="action-btn btn-danger" disabled
                    onclick="deleteSelectedImages()"><i class="fa-solid fa-trash"></i>Smazat vybran√© (<span
                        id="selectedCount">0</span>) </button><button class="primary-btn"
                    onclick="document.getElementById('imageUploadInput').click()"><i
                        class="fa-solid fa-cloud-arrow-up"></i>Nahr√°t fotky </button>
            </div><input type="file" id="imageUploadInput" multiple accept="image/*" style="display: none;"
                onchange="handleAdminGalleryUpload(this)">
        </div>
        <div class="card" style="padding: 0;">
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;"><input type="checkbox" id="selectAllGallery"
                                    onclick="toggleSelectAllGallery(this)"></th>
                            <th>N√°hled</th>
                            <th>N√°zev / Popisek</th>
                            <th>Ve≈ôejn√©</th>
                            <th>Datum nahr√°n√≠</th>
                            <th>Akce</th>
                        </tr>
                    </thead>
                    <tbody id="galleryTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center;">Naƒç√≠t√°m...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>
    </div>
    <!-- Member Modal -->
    <div id="memberModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 500px;">
            <h2 id="memberModalTitle" style="margin-top: 0;">Nov√Ω ƒçlen</h2><input type="hidden" id="memberId">
            <div class="form-group"><label>Jm√©no *</label><input type="text" id="memberFirstName" placeholder="Jan">
            </div>
            <div class="form-group"><label>P≈ô√≠jmen√≠ *</label><input type="text" id="memberLastName" placeholder="Nov√°k">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group"><label>ELO</label><input type="number" id="memberElo"></div>
                <div class="form-group"><label>Titul</label><input type="text" id="memberTitle" placeholder="Nap≈ô. FM">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group"><label>Rok narozen√≠</label><input type="number" id="memberBirthYear"></div>
                <div class="form-group"><label>Role</label><input type="text" id="memberRole"
                        placeholder="Nap≈ô. P≈ôedseda"></div>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;">
                <button class="btn-secondary" onclick="closeMemberModal()">Zru≈°it</button><button class="btn-primary"
                    onclick="saveMember()">Ulo≈æit</button>
            </div>
        </div>
    </div>
    <script src="js/config.js"></script>
    <script src="js/admin/admin-gallery.js?v=20251211_2"></script>
    <script src="js/admin/admin-news.js?v=20251211_1"></script>
    <script src="js/admin/admin-members.js"></script>
    <script src="js/admin/admin-messages.js"></script>
    <script src="js/admin/admin-competitions.js?v=20251212_1"></script>
    <script> // Admin Panel Logic - use API_URL from config.js
        var authToken = null;
        let currentUser = null;
        // let uploadedImageData = null; // Moved to admin-news.js
        // let currentImageOriginalName = ''; // Moved to admin-news.js
        // let games = []; // Moved to admin-games.js
        // let teams = ['A t√Ωm', 'B t√Ωm']; // Default teams // Moved to admin-games.js
        // let galleryImages = []; // Moved to admin-news.js

        // Init
        window.addEventListener('DOMContentLoaded', () => {
            authToken = localStorage.getItem('authToken');

            if (authToken) {
                verifyToken();
                checkMaintenance();
            }

            else showLogin();

            // Editor Enter Key Handler - Clean formatting on new line
            const editor = document.getElementById('articleContent');

            if (editor) {
                // Ensure paragraphs are used for new lines
                document.execCommand('defaultParagraphSeparator', false, 'p');

                editor.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        const sel = window.getSelection();
                        if (!sel.rangeCount) return;

                        // Check if we are inside a highlight
                        let node = sel.anchorNode;
                        if (node.nodeType === 3) node = node.parentNode;

                        if (node.classList && (node.classList.contains('highlight-name') || node.classList.contains('highlight-score'))) {
                            e.preventDefault(); // Stop default browser behavior (which might be just <br> in span)

                            // Force a paragraph break
                            // This splits the block: <p><span class="h">...</span></p> <p><span class="h">...</span></p>
                            document.execCommand('insertParagraph');

                            // Now clean the style on the NEW line
                            // The cursor should be in the new paragraph now

                            // We need to wait a tick for the DOM to settle? execCommand is usually synchronous but let's be safe cleaning up
                            // actually execCommand IS synchronous.

                            const newSel = window.getSelection();
                            let newNode = newSel.anchorNode;
                            if (newNode.nodeType === 3) newNode = newNode.parentNode;

                            // Find the highlight span in this new block and unwrap/clear it
                            // We might be inside the span in the new paragraph
                            if (newNode.classList && (newNode.classList.contains('highlight-name') || newNode.classList.contains('highlight-score'))) {
                                // We are inside the span in the new line.
                                // Remove class to make it plain text
                                newNode.className = '';

                                // Remove ZWS if present
                                if (newNode.innerHTML.includes('\u200B')) {
                                    newNode.innerHTML = newNode.innerHTML.replace(/\u200B/g, '');
                                }

                                // If the span is now empty/useless, we might want to unwrap it entirely, 
                                // but removing class is enough to visually "reset" it.

                                // However, often we want to remove the span tag nicely.
                                // document.execCommand('removeFormat') might be cleaner?
                                // Let's stick to removing class as it's targeted.
                            }

                            checkToolbarState();
                        }

                        else {
                            // Normal Enter functionality - verify clean state on next tick if needed
                        }
                    }
                });
            }
        });

        async function checkMaintenance() {
            try {
                const res = await fetch(`${API_URL}/settings`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                const settings = await res.json();
                document.getElementById('maintenanceToggle').checked = settings.maintenance_mode === 'true';
            }

            catch (e) {
                console.error(e);
            }
        }

        async function toggleMaintenance() {
            const toggle = document.getElementById('maintenanceToggle');
            const value = toggle.checked;

            try {
                const res = await fetch(`${API_URL}/settings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        key: 'maintenance_mode', value: value
                    })
                });

                if (res.ok) {
                    showAlert(value ? 'Re≈æim √∫dr≈æby ZAPNUT' : 'Re≈æim √∫dr≈æby VYPNUT', value ? 'success' : 'success');
                }

                else {
                    toggle.checked = !value; // Revert on error
                    showAlert('Chyba p≈ôi zmƒõnƒõ nastaven√≠', 'error');
                }
            }

            catch (e) {
                toggle.checked = !value;
                showAlert('Chyba spojen√≠', 'error');
            }
        }

        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        function showAdmin() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');

            // Show tabs based on role (case-insensitive check)
            const role = (currentUser.role || '').toLowerCase();
            const isAdminOrSuperadmin = ['admin', 'superadmin'].includes(role);

            console.log('[RBAC-INLINE] User:', currentUser.username, 'Role:', currentUser.role, '-> normalized:', role, 'isAdmin:', isAdminOrSuperadmin);

            if (isAdminOrSuperadmin) {
                const galleryBtn = document.getElementById('galleryTab');
                if (galleryBtn) {
                    galleryBtn.classList.remove('hidden');
                    galleryBtn.style.display = 'inline-block';
                }

                // Users tab
                const usersBtn = document.getElementById('usersTab');
                if (usersBtn) {
                    usersBtn.classList.remove('hidden');
                    usersBtn.style.display = 'inline-block';
                }

                // Competitions tab
                const compBtn = document.getElementById('competitionsTab');
                if (compBtn) {
                    compBtn.classList.remove('hidden');
                    compBtn.style.display = 'inline-block';
                }
            }

            loadDashboard();
        }

        async function verifyToken() {
            try {
                const res = await fetch(`${API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (res.ok) {
                    currentUser = await res.json();

                    document.getElementById('userInfo').textContent = `${currentUser.username} (${currentUser.role})`;
                    showAdmin();
                }

                else {
                    logout();
                }
            }

            catch (e) {
                logout();
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            const activeTab = document.querySelector(`.nav-tab[onclick="switchTab('${tab}')"]`);
            if (activeTab) activeTab.classList.add('active');

            ['dashboard',
                'editor',
                'members',
                'users',
                'messages',
                'blicak',
                'competitions',
                'gallery',
                'puzzleRacer'].forEach(v => {
                    const el = document.getElementById(v + 'View');
                    if (el) el.classList.add('hidden');
                });

            const view = document.getElementById(tab + 'View');
            if (view) view.classList.remove('hidden');

            if (tab === 'dashboard') loadDashboard();
            else if (tab === 'members') loadMembers();
            else if (tab === 'users') loadUsers();
            else if (tab === 'messages') loadAdminMessages();
            else if (tab === 'blicak') loadBlicakRegistrations();
            else if (tab === 'competitions') loadCompetitions();
            else if (tab === 'gallery') loadAdminGallery();
            else if (tab === 'puzzleRacer') loadPuzzleRacerSettings();
        }

        // --- Puzzle Racer Settings ---
        async function loadPuzzleRacerSettings() {
            try {
                const res = await fetch(`${API_URL}/racer/settings`);
                const settings = await res.json();

                document.getElementById('prTheme').value = settings.puzzleTheme || 'mix';
                document.getElementById('prTimeLimit').value = settings.timeLimitSeconds || 180;
                document.getElementById('prLivesEnabled').checked = settings.livesEnabled !== false;
                document.getElementById('prMaxLives').value = settings.maxLives || 3;
                document.getElementById('prPuzzlesPerDifficulty').value = settings.puzzlesPerDifficulty || 6;
                document.getElementById('prPenaltyEnabled').checked = settings.penaltyEnabled === true;
                document.getElementById('prPenaltySeconds').value = settings.penaltySeconds || 5;
                document.getElementById('prSkipOnMistake').checked = settings.skipOnMistake === true;

                // New: Randomize
                document.getElementById('prRandomizePuzzles').checked = settings.randomizePuzzles !== false;
                togglePrRandomizeUI(); // visuals

                // Toggle visibility of dependent fields
                document.getElementById('prMaxLivesGroup').style.display = document.getElementById('prLivesEnabled').checked ? 'block' : 'none';
                document.getElementById('prPenaltySecondsGroup').style.display = document.getElementById('prPenaltyEnabled').checked ? 'block' : 'none';
            }

            catch (e) {
                console.error('Failed to load puzzle racer settings:', e);
            }
        }

        function togglePrRandomizeUI() {
            const isRandom = document.getElementById('prRandomizePuzzles').checked;
            const btn = document.getElementById('prRefreshSetBtn');
            if (btn) btn.style.display = isRandom ? 'none' : 'block';
        }

        async function refreshPrFixedSet() {
            if (!confirm('Opravdu chcete vygenerovat novou sadu √∫loh? Star√° sada bude zahozena.')) return;

            const btn = document.getElementById('prRefreshSetBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Generuji...';
            btn.disabled = true;

            try {
                const res = await fetch(`${API_URL}/racer/settings/refresh-set`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                if (res.ok) alert('Nov√° sada byla vygenerov√°na (cache smaz√°na). P≈ôi p≈ô√≠≈°t√≠ h≈ôe se naƒçtou nov√© √∫lohy.');
                else alert('Chyba p≈ôi generov√°n√≠.');
            } catch (e) {
                console.error(e);
                alert('Chyba spojen√≠.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function savePuzzleRacerSettings() {
            const btn = document.getElementById('savePrSettingsBtn');
            const result = document.getElementById('prSettingsResult');

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Ukl√°d√°m...';
            result.textContent = '';

            try {
                const res = await fetch(`${API_URL}/racer/settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        puzzleTheme: document.getElementById('prTheme').value,
                        timeLimitSeconds: parseInt(document.getElementById('prTimeLimit').value),
                        livesEnabled: document.getElementById('prLivesEnabled').checked,
                        maxLives: parseInt(document.getElementById('prMaxLives').value),
                        puzzlesPerDifficulty: parseInt(document.getElementById('prPuzzlesPerDifficulty').value),
                        penaltyEnabled: document.getElementById('prPenaltyEnabled').checked,
                        penaltySeconds: parseInt(document.getElementById('prPenaltySeconds').value),
                        skipOnMistake: document.getElementById('prSkipOnMistake').checked,
                        randomizePuzzles: document.getElementById('prRandomizePuzzles').checked
                    })
                });

                if (res.ok) {
                    result.innerHTML = '<span style="color: #4ade80;"><i class="fa-solid fa-check"></i> Ulo≈æeno!</span>';
                }

                else {
                    result.innerHTML = '<span style="color: #fca5a5;">Chyba p≈ôi ukl√°d√°n√≠</span>';
                }
            }

            catch (e) {
                console.error(e);
                result.innerHTML = '<span style="color: #fca5a5;">Chyba spojen√≠</span>';
            }

            finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-save"></i> Ulo≈æit nastaven√≠';
            }
        }

        // Toggle visibility of dependent settings fields
        document.addEventListener('DOMContentLoaded', () => {
            const livesCheck = document.getElementById('prLivesEnabled');
            const penaltyCheck = document.getElementById('prPenaltyEnabled');

            if (livesCheck) {
                livesCheck.addEventListener('change', () => {
                    document.getElementById('prMaxLivesGroup').style.display = livesCheck.checked ? 'block' : 'none';
                });
            }

            if (penaltyCheck) {
                penaltyCheck.addEventListener('change', () => {
                    document.getElementById('prPenaltySecondsGroup').style.display = penaltyCheck.checked ? 'block' : 'none';
                });
            }
        });

        // Dashboard
        async function loadDashboard() {
            try {
                const res = await fetch(`${API_URL}/news`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                const news = await res.json();

                document.getElementById('newsTableBody').innerHTML = news.map(item => `
                    <tr>
                        <td>${new Date(item.publishedDate).toLocaleDateString('cs-CZ')}</td>
                        <td>${item.title}</td>
                        <td class="hide-mobile">${item.category}</td>
                        <td class="hide-mobile"><span class="highlight-name" style="font-size: 0.85rem;">${item.author?.username || '-'}</span></td>
                        <td class="hide-mobile">
                            <span class="status-badge ${item.isPublished ? 'status-published' : 'status-draft'}">
                                ${item.isPublished ? '‚úì' : '‚óã'}
                                <span class="status-text">${item.isPublished ? ' Pub' : ' Konc'}</span>
                            </span>
                        </td>
                        <td>
                            <button class="action-btn btn-edit" onclick="editNews(${item.id})"><i class="fa-solid fa-pen"></i></button>
                            <button class="action-btn btn-publish" onclick="togglePublish(${item.id})" title="${item.isPublished ? 'Skr√Ωt' : 'Publikovat'}"><i class="fa-solid fa-${item.isPublished ? 'eye-slash' : 'eye'}"></i></button>
                            ${['admin', 'superadmin'].includes(currentUser.role) ? `<button class="action-btn btn-delete" onclick="deleteNews(${item.id})"><i class="fa-solid fa-trash"></i></button>` : ''}
                        </td>
                    </tr>
                `).join('');
            }

            catch (e) {
                console.error(e);
            }
        }

        async function togglePublish(id) {
            try {
                await fetch(`${API_URL}/news/${id}/publish`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                loadDashboard();
            }

            catch (e) {
                console.error(e);
            }
        }

        async function loadBlicakRegistrations() {
            // Load Registrations
            try {
                const res = await fetch(`${API_URL}/registration/blicak`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (res.ok) {
                    const regs = await res.json();
                    const tbody = document.getElementById('blicakTableBody');
                    const info = document.getElementById('noBlicakInfo');

                    if (regs.length === 0) {
                        tbody.innerHTML = '';
                        info.style.display = 'block';
                    } else {
                        info.style.display = 'none';
                        tbody.innerHTML = regs.map(reg => `
                            <tr>
                                <td><strong>${escapeHtml(reg.name)}</strong></td>
                                <td>${escapeHtml(reg.club || '-')}</td>
                                <td>${escapeHtml(reg.lok || '-')}</td>
                                <td>${escapeHtml(reg.birthYear)}</td>
                                <td>${new Date(reg.createdAt).toLocaleString('cs-CZ')}</td>
                            </tr>`).join('');
                    }
                }
            } catch (e) {
                console.error(e);
            }

            // Load Blic√°k Gallery Preview (Optional, for now just the upload button is handled in the view)
        }

        // Editor


        // Games Management


        // Users
        async function loadUsers() {
            try {
                const res = await fetch(`${API_URL}/users`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                const users = await res.json();

                document.getElementById('usersTableBody').innerHTML = users.map(u => `
                    <tr>
                        <td>${u.username}</td>
                        <td>${u.email}</td>
                        <td>
                            <select onchange="updateUserRole(${u.id}, this.value)" style="padding: 0.25rem;">
                                <option value="admin" ${u.role === 'admin' ? 'selected' : ''}>Admin</option>
                                <option value="editor" ${u.role === 'editor' ? 'selected' : ''}>Editor</option>
                                <option value="superadmin" ${u.role === 'superadmin' ? 'selected' : ''}>Superadmin</option>
                            </select>
                        </td>
                        <td>${new Date(u.createdAt).toLocaleDateString('cs-CZ')}</td>
                        <td>
                            ${u.id !== currentUser.id ? `<button class="action-btn btn-delete" onclick="deleteUser(${u.id})"><i class="fa-solid fa-trash"></i></button>` : ''}
                        </td>
                    </tr>
                `).join('');
            }

            catch (e) {
                console.error(e);
            }
        }

        async function updateUserRole(id, newRole) {
            try {
                const res = await fetch(`${API_URL}/users/${id}/role`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ role: newRole })
                });

                if (res.ok) {
                    showAlert(`Role zmƒõnƒõna na ${newRole}`, 'success');
                }

                else {
                    showAlert('Chyba p≈ôi zmƒõnƒõ role', 'error');
                    loadUsers(); // Revert
                }
            }

            catch (e) {
                console.error(e);
                showAlert('Chyba spojen√≠', 'error');
            }
        }



        // Messages (Vzkazovn√≠k)
        // Messages Logic - now loaded from js/admin/admin-messages.js

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Delete News (for superadmin)


        // Auth
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: document.getElementById('username').value,
                        password: document.getElementById('password').value
                    })
                });

                if (res.ok) {
                    const data = await res.json();
                    authToken = data.token;
                    currentUser = data.user;
                    localStorage.setItem('authToken', authToken);
                    showAdmin();
                }

                else {
                    document.getElementById('loginError').innerHTML = '<div class="alert alert-error">Chybn√© √∫daje</div>';
                }
            }

            catch (e) {
                document.getElementById('loginError').innerHTML = '<div class="alert alert-error">Chyba spojen√≠</div>';
            }
        });

        // Password Toggle
        const togglePassword = document.querySelector('#togglePassword');
        const password = document.querySelector('#password');

        togglePassword.addEventListener('click', function () {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });

        function logout() {
            localStorage.removeItem('authToken');
            location.reload();
        }

        function showAlert(msg, type) {
            const div = document.createElement('div');

            div.className = `alert alert-${type}`;

            // Add icon based on type
            const icon = type === 'success' ? '<i class="fa-solid fa-check-circle"></i>' : '<i class="fa-solid fa-exclamation-circle"></i>';

            div.innerHTML = `<div style="display:flex;align-items:center;gap:10px;">
                    ${icon}
                    <span>${msg}</span>
                </div>`;

            // Add close button
            const close = document.createElement('i');
            close.className = 'fa-solid fa-times';
            close.style.cssText = 'cursor:pointer; margin-left:10px; opacity:0.7;';
            close.onclick = () => div.remove();
            div.firstChild.appendChild(close);

            document.getElementById('alertContainer').appendChild(div);

            // Longer timeout for errors
            const timeout = type === 'error' ? 6000 : 3000;

            setTimeout(() => {
                if (div.parentNode) {
                    div.style.opacity = '0';
                    div.style.transform = 'translateX(100%)';
                    div.style.transition = 'all 0.3s';
                    setTimeout(() => div.remove(), 300);
                }
            }

                , timeout);
        }

        window.showToast = showAlert;

        // updateStandings() moved to js/admin/admin-competitions.js


        // loadCompetitions(), toggleCompetitionActive(), changeSourceUrl() 
        // moved to js/admin/admin-competitions.js





        // Collapsible sidebar sections
        function toggleSidebarSection(section) {
            const content = document.getElementById(section + 'Content');
            const icon = document.getElementById(section + 'Icon');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(0deg)';
            }

            else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(-90deg)';
            }
        }

    </script>

    <!-- Admin modules already loaded at lines 1762-1767, DO NOT duplicate here -->
    <!-- Legacy Admin Script -->
    <!-- <script src="js/admin.js"></script> -->
</body>


</html>